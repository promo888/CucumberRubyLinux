2016-01-04_07:37:10,079 -- Started

---Writing regular output to log /export/home/oracle/Automation/logs_PT_DB/ptradeDB_schema_install_automatic.log---
***Writing debug output to log /export/home/oracle/Automation/logs_PT_DB/ptradeDB_schema_install_automatic.log***

[33m2016-01-04_07:37:10,083 -- Getting package...[0m
[33mPath to package was given explicitly, getting /export/home/oracle/build_server/Releases/PTS/1.3.13.0/PTS_MAIN_1.3.13.0.407.tar.gz[0m
`/export/home/oracle/build_server/Releases/PTS/1.3.13.0/PTS_MAIN_1.3.13.0.407.tar.gz' -> `/export/home/oracle/Automation/packages/PTS_MAIN_1.3.13.0.407.tar.gz'
Copying finished
setting env variable AUTOMATION_PACKAGE_NAME_ptrade in .bashrc
[33m
2016-01-04_07:37:10,846 -- Extracting PTS_MAIN_1.3.13.0.407.tar.gz to /export/home/oracle/Automation/packages...
[0m
doc_1.3.13.0/Monitoring_Spreadsheet_PTS.xlsm
doc_1.3.13.0/Schema Backup and Rollback.docx
PT_APP_1.3.13.0/pts_installer.sh
PT_APP_1.3.13.0/PTS_1.3.13.0.407.tar.gz
PT_DB_1.3.13.0/db_config_dev.sql
PT_DB_1.3.13.0/db_config_prod.sql
PT_DB_1.3.13.0/db_config_qa.sql
PT_DB_1.3.13.0/fresh_schema.sql
PT_DB_1.3.13.0/install_ptrade_db.sh
PT_DB_1.3.13.0/update_ptrade_db.sh
PT_DB_1.3.13.0/db_bkp_rlbk.sh
PT_DB_1.3.13.0/upgrade_ptrade_1.3.13.0.sql
[32m"PT_DB_1.3.13.0" from the package "PTS_MAIN_1.3.13.0.407.tar.gz" was extracted in /export/home/oracle/Automation/packages as "PT_DB_1.3.13.0_ptrade"[0m
[33m
2016-01-04_07:37:11,617 -- Starting installation...[0m
[33m
2016-01-04_07:37:11,619 -- Removing oracle archive logs with RMAN...
[0m
[33m
setting PTS_AUTOMATION_LOGS_HOME[0m
set PTS_AUTOMATION_LOGS_HOME: /export/home/oracle/Automation/logs_PT_DB
[33m
setting PTS_AUTOMATION_USERNAME[0m
set PTS_AUTOMATION_USERNAME: ptrade

Reading PTS_AUTOMATION_LOGS_HOME
Found PTS_AUTOMATION_LOGS_HOME
Reading PTS_AUTOMATION_USERNAME
Found PTS_AUTOMATION_USERNAME
spawn bash
rman
[oracle@tyobpdb01m-tlvq ~]$ rman

Recovery Manager: Release 12.1.0.2.0 - Production on Mon Jan 4 07:37:12 2016

Copyright (c) 1982, 2014, Oracle and/or its affiliates.  All rights reserved.

RMAN> connect target

connected to target database: PTDB (DBID=1589690390)

RMAN> delete force archivelog all completed before 'sysdate -2/24';

using target database control file instead of recovery catalog
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=259 device type=DISK
List of Archived Log Copies for database with db_unique_name PTDB_TYOBPDB01M_TLVQ
=====================================================================

Key     Thrd Seq     S Low Time 
------- ---- ------- - ---------
169     1    174     A 03-JAN-16
        Name: +FLSH/PTDB_TYOBPDB01M_TLVQ/ARCHIVELOG/2016_01_03/thread_1_seq_174.268.900185731

170     1    175     A 03-JAN-16
        Name: +FLSH/PTDB_TYOBPDB01M_TLVQ/ARCHIVELOG/2016_01_04/thread_1_seq_175.311.900201663


Do you really want to delete the above objects (enter YES or NO)? YES
deleted archived log
archived log file name=+FLSH/PTDB_TYOBPDB01M_TLVQ/ARCHIVELOG/2016_01_03/thread_1_seq_174.268.900185731 RECID=169 STAMP=900185752
deleted archived log
archived log file name=+FLSH/PTDB_TYOBPDB01M_TLVQ/ARCHIVELOG/2016_01_04/thread_1_seq_175.311.900201663 RECID=170 STAMP=900201695
Deleted 2 objects


RMAN> exit


Recovery Manager complete.
[oracle@tyobpdb01m-tlvq ~]$ [32m
2016-01-04_07:37:26,286 -- Finished RMAN
[0m
[33m
2016-01-04_07:37:26,288 -- Dropping user ptrade[0m

SQL*Plus: Release 12.1.0.2.0 Production on Mon Jan 4 07:37:26 2016

Copyright (c) 1982, 2014, Oracle.  All rights reserved.


Connected to:
Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning and Automatic Storage Management options

SQL> SQL> SQL> SQL> SQL> SQL> SQL> SQL> SQL> SQL> sqlplus-- Dropping user ptrade, please wait...
SQL> SQL>   2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32  SQL> sqlplus-- User ptrade dropped!
SQL> Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning and Automatic Storage Management options
[32m2016-01-04_07:38:24,176 -- Dropping user "ptrade" finished[0m
[32m[0m
[33m2016-01-04_07:38:24,178 -- Creating user ptrade...[0m
START_TIME is 20160104-07:38:24
set_env is complete
Done
SQLPLUS RESULT create_user is:

SQL*Plus: Release 12.1.0.2.0 Production on Mon Jan 4 07:38:24 2016

Copyright (c) 1982, 2014, Oracle.  All rights reserved.


Connected to:
Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning and Automatic Storage Management options

SQL> SQL> SQL> SQL> SQL> SQL> SQL> SQL>   2    3    4    5    6  
PL/SQL procedure successfully completed.

SQL> SQL>   2    3    4    5    6  
PL/SQL procedure successfully completed.

SQL>   2    3    4    5  
User created.

SQL> SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> 
Grant succeeded.

SQL> SQL> Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning and Automatic Storage Management options
create_schema is done
Finished create_app_users at 20160104-07:38:24 
[32m2016-01-04_07:38:24,930 -- Creating ptrade user completed[0m
[32m[0m
[33mStart installing ptrade...[0m
grant execute on dbms_flashback to ^DB_USER
                                   *
ERROR at line 1:
ORA-00987: missing or invalid username(s)


grant administer database trigger to ^DB_USER
                                     *
ERROR at line 1:
ORA-00987: missing or invalid username(s)



SQL*Plus: Release 12.1.0.2.0 Production on Mon Jan 4 07:38:24 2016

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

SQL> SQL> SQL> SQL> SQL> SQL> DEFINE DB_USER=ptrade
SQL> DEFINE DB_PWD=^DB_USER
SQL> DEFINE TBL_TBS=PTRADEDATA
SQL> DEFINE IDX_TBS=PTRADEINDX
SQL> DEFINE PARTITIONS_NUM=50
SQL> Connected.
SQL> SQL> 



SQL> SQL> SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/sqlplus_settings.sql  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/sqlplus_settings.sql  ****/
SQL> set define "^"
SQL> set trimout on
SQL> set trimspool on
SQL> set echo on
SQL> set timing on
SQL> set time on
07:38:25 SQL> set feedback on
07:38:25 SQL> set linesize 1000
07:38:25 SQL> set pagesize 1000
07:38:25 SQL> set verify on
07:38:25 SQL> 
07:38:25 SQL> 
07:38:25 SQL> 
07:38:25 SQL> 
07:38:25 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/version.sql  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/version.sql  ****/
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=6
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=6
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=1
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=2
07:38:25 SQL> DEFINE ebs=6
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=2
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=0
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE minor=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=0
07:38:25 SQL> DEFINE ebs=0
07:38:25 SQL> DEFINE minor=0
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=3
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=5
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=6
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=6
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=6
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=7
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=8
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=8
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=8
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=8
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=8
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=9
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=4
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=10
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=11
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=11
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=11
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=11
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=12
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=12
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=12
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=13
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> DEFINE major=1
07:38:25 SQL> DEFINE minor=3
07:38:25 SQL> DEFINE ebs=13
07:38:25 SQL> DEFINE patch=-p0
07:38:25 SQL> 
07:38:25 SQL> 
07:38:25 SQL> 
07:38:25 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/get_schema_info.sql  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/get_schema_info.sql  ****/
07:38:25 SQL> select
07:38:25   2  	      'Current_date:..'||to_char(sysdate,'yyyy-mm-dd hh24:mi:ss')
07:38:25   3  	      ||chr(10)||chr(13)||'### OS info'
07:38:25   4  	      ||chr(10)||chr(13)||'TERMINAL:......' || SYS_CONTEXT('USERENV', 'TERMINAL')
07:38:25   5  	      ||chr(10)||chr(13)||'CLIENT_IP:.....' || SYS_CONTEXT('USERENV', 'IP_ADDRESS')
07:38:25   6  	      ||chr(10)||chr(13)||'OS_USER:.......' || SYS_CONTEXT('USERENV', 'OS_USER')
07:38:25   7  	      ||chr(10)||chr(13)||'EXTERNAL_NAME:.' || SYS_CONTEXT('USERENV', 'EXTERNAL_NAME')
07:38:25   8  	      ||chr(10)||chr(13)||'### Database info'
07:38:25   9  	      ||chr(10)||chr(13)||'DB_NAME:.......' || SYS_CONTEXT('USERENV', 'DB_NAME')
07:38:25  10  	      ||chr(10)||chr(13)||'DB_UNIQUE_NAME:' || SYS_CONTEXT('USERENV', 'DB_UNIQUE_NAME')
07:38:25  11  	      ||chr(10)||chr(13)||'DB Server:.....' || SYS_CONTEXT('USERENV', 'HOST')
07:38:25  12  	      ||chr(10)||chr(13)||'SERVICE_NAME:..' || SYS_CONTEXT('USERENV', 'SERVICE_NAME')
07:38:25  13  	      ||chr(10)||chr(13)||'### Session info'
07:38:25  14  	      ||chr(10)||chr(13)||'CURRENT_USER:..' || SYS_CONTEXT('USERENV', 'CURRENT_USER')
07:38:25  15  	      ||chr(10)||chr(13)||'CURRENT_SCHEMA:' || SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')
07:38:25  16  	      ||chr(10)||chr(13)||'SESSION_USER:..' || SYS_CONTEXT('USERENV', 'SESSION_USER')
07:38:25  17  	      ||chr(10)||chr(13)||'ISDBA:.........' || SYS_CONTEXT('USERENV', 'ISDBA')
07:38:25  18  	      ||chr(10)||chr(13)||'SESSIONID:.....' || SYS_CONTEXT('USERENV', 'SESSIONID') "Database Info"
07:38:25  19  from dual ;

Database Info
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Current_date:..2016-01-04 07:38:25
### OS info
TERMINAL:......
CLIENT_IP:.....
OS_USER:.......oracle
EXTERNAL_NAME:.oracle
### Database info
DB_NAME:.......PTDB
DB_UNIQUE_NAME:PTDB_TYOBPDB01M_TLVQ
DB Server:.....tyobpdb01m-tlvq.ap.icap.com
SERVICE_NAME:..SYS$USERS
### Session info
CURRENT_USER:..PTRADE
CURRENT_SCHEMA:PTRADE
SESSION_USER:..PTRADE
ISDBA:.........FALSE
SESSIONID:.....1210770


1 row selected.

Elapsed: 00:00:00.01
07:38:25 SQL> 
07:38:25 SQL> select 'ROLE' Type, GRANTED_ROLE, ADMIN_OPTION, DEFAULT_ROLE from USER_ROLE_PRIVS
07:38:25   2  union all
07:38:25   3  select 'PRIV' Type, PRIVILEGE, ADMIN_OPTION, null from USER_SYS_PRIVS
07:38:25   4  order by 1,2;

TYPE GRANTED_ROLE														      ADM DEF
---- -------------------------------------------------------------------------------------------------------------------------------- --- ---
PRIV ADMINISTER DATABASE TRIGGER												      NO
PRIV CREATE ANY CONTEXT 													      NO
PRIV CREATE JOB 														      NO
PRIV CREATE MATERIALIZED VIEW													      NO
PRIV CREATE SYNONYM														      NO
PRIV CREATE VIEW														      NO
PRIV DROP ANY CONTEXT														      NO
PRIV SELECT ANY DICTIONARY													      NO
PRIV UNLIMITED TABLESPACE													      NO
ROLE CONNECT															      NO  YES
ROLE RESOURCE															      NO  YES

11 rows selected.

Elapsed: 00:00:00.19
07:38:25 SQL> 
07:38:25 SQL> 
07:38:25 SQL> select owner, table_name as object_name, grantor, privilege
07:38:25   2  from all_tab_privs_recd
07:38:25   3  where grantee = USER
07:38:25   4  order by owner, table_name;

OWNER																 OBJECT_NAME															  GRANTOR															   PRIVILEGE
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
SYS																 DATA_PUMP_DIR															  SYS																   WRITE
SYS																 DATA_PUMP_DIR															  SYS																   READ
SYS																 DBMS_APPLICATION_INFO														  SYS																   EXECUTE
SYS																 DBMS_FLASHBACK 														  SYS																   EXECUTE
SYS																 DBMS_LOB															  SYS																   EXECUTE
SYS																 DBMS_LOCK															  SYS																   EXECUTE
SYS																 DBMS_SQL															  SYS																   EXECUTE
SYS																 DBMS_WORKLOAD_REPOSITORY													  SYS																   EXECUTE
SYS																 DBMS_XPLAN															  SYS																   EXECUTE

9 rows selected.

Elapsed: 00:00:01.54
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/SCHEMA_AUDIT.util	****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/SCHEMA_AUDIT.util  ****/
07:38:27 SQL> 
07:38:27 SQL> CREATE TABLE log_ddl (
07:38:27   2  	      ddl_date	    timestamp default systimestamp,
07:38:27   3  	      ddl_type	    VARCHAR2(30),
07:38:27   4  	      object_type   VARCHAR2(18),
07:38:27   5  	      owner	    VARCHAR2(30),
07:38:27   6  	      object_name   VARCHAR2(128),
07:38:27   7  	      sql_statment  clob,
07:38:27   8  	      sid		number,
07:38:27   9  	      username	      VARCHAR2(100),
07:38:27  10  	      osuser	      VARCHAR2(100),
07:38:27  11  	      maCHINE	      VARCHAR2(100),
07:38:27  12  	      TERMINAL	      VARCHAR2(100),
07:38:27  13  	      PROGRAM	      VARCHAR2(100),
07:38:27  14  	      MODULE	      VARCHAR2(100),
07:38:27  15  	      CLIENT_INFO VARCHAR2(100),
07:38:27  16  	      SCN	      number(30)
07:38:27  17  );

Table created.

Elapsed: 00:00:00.02
07:38:27 SQL> 
07:38:27 SQL> CREATE OR REPLACE TRIGGER ddl_trig_before  BEFORE  DDL ON DATABASE
07:38:27   2  DECLARE
07:38:27   3  	      sql_text	      ora_name_list_t;
07:38:27   4  	      n 	      pls_integer;
07:38:27   5  	      currentDDL  clob;
07:38:27   6  BEGIN
07:38:27   7  	      if (ora_dict_obj_owner='^_USER') THEN
07:38:27   8  		      -- Extract executed DDL into temporary CLOB
07:38:27   9  		      dbms_lob.createTemporary(currentDDL, true);
07:38:27  10  		      n := ora_sql_txt(sql_text);
07:38:27  11  		      for i in 1..n loop
07:38:27  12  			      dbms_lob.append(currentDDL, sql_text(i));
07:38:27  13  		      end loop;
07:38:27  14  		      -- Log DDL info
07:38:27  15  		      INSERT INTO log_ddl ( ddl_type, object_type, owner,  object_name, sql_statment, sid, username, osuser, maCHINE, TERMINAL, PROGRAM, MODULE, CLIENT_INFO, scn)
07:38:27  16  		      SELECT /* DDL Info --> */ora_sysevent, ora_dict_obj_type, ora_dict_obj_owner, ora_dict_obj_name, currentDDL,
07:38:27  17  			     /* Executing session info --> */sid, username, osuser, maCHINE, TERMINAL, PROGRAM, MODULE, CLIENT_INFO, dbms_flashback.get_system_change_number
07:38:27  18  		      FROM V$SESSION S
07:38:27  19  		      WHERE sid=sys_context('USERENV','SID');
07:38:27  20  		      -- Release temporary clob
07:38:27  21  		      dbms_lob.freetemporary(currentDDL);
07:38:27  22  	      END IF;
07:38:27  23  END ddl_trig;
07:38:27  24  /
old   7: 	if (ora_dict_obj_owner='^_USER') THEN
new   7: 	if (ora_dict_obj_owner='PTRADE') THEN

Trigger created.

Elapsed: 00:00:00.21
07:38:27 SQL> show errors
No errors.
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/PKG_UPLOAD_UTIL.util  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/PKG_UPLOAD_UTIL.util  ****/
07:38:27 SQL> /*
07:38:27 SQL> execute execute immediate 'drop package upgrade_utils ';
07:38:27 SQL> execute execute immediate 'drop view V_UPGRADE_STEPS ';
07:38:27 SQL> execute execute immediate 'drop sequence SEQ_UPGRADE_STEPS ';
07:38:27 SQL> execute execute immediate 'drop table LOG_UPLOADS ';
07:38:27 SQL> execute execute immediate 'drop table UPGRADE_STEPS ';
07:38:27 SQL> --exit
07:38:27 SQL> */
07:38:27 SQL> 
07:38:27 SQL> CREATE SEQUENCE SEQ_LOG_UPLOADS;

Sequence created.

Elapsed: 00:00:00.21
07:38:27 SQL> CREATE TABLE LOG_UPLOADS (
07:38:27   2  	 id		number(30) not null,
07:38:27   3  	 Application	varchar2(100),
07:38:27   4  	 Major		Number(10),
07:38:27   5  	 Minor		Number(10),
07:38:27   6  	 Patch		Number(10),
07:38:27   7  	 Build		Number(10),
07:38:27   8  	 Status 	VARCHAR2(50),
07:38:27   9  	 Start_Time	date  default sysdate,
07:38:27  10  	 End_time	date,
07:38:27  11  	 Comments	varchar2(4000)
07:38:27  12  );

Table created.

Elapsed: 00:00:00.03
07:38:27 SQL> CREATE UNIQUE INDEX PK_LOG_UPLOADS ON LOG_UPLOADS(ID);

Index created.

Elapsed: 00:00:00.03
07:38:27 SQL> ALTER TABLE LOG_UPLOADS ADD CONSTRAINT PK_LOG_UPLOADS PRIMARY KEY (ID) USING INDEX;

Table altered.

Elapsed: 00:00:00.03
07:38:27 SQL> 
07:38:27 SQL> create sequence SEQ_UPGRADE_STEPS;

Sequence created.

Elapsed: 00:00:00.00
07:38:27 SQL> -- Create table
07:38:27 SQL> CREATE TABLE UPGRADE_STEPS (
07:38:27   2  	id		     NUMBER(30) not null ,
07:38:27   3  	upgrade_id	     NUMBER,
07:38:27   4  	date_added	     DATE default SYSDATE not null,
07:38:27   5  	status		     NUMBER(2) DEFAULT 0 not null,
07:38:27   6  	action		     NUMBER(2) not null,
07:38:27   7  	error_message	     VARCHAR2(4000),
07:38:27   8  	object_type	     NUMBER(2) not null,
07:38:27   9  	object_name	     VARCHAR2(30) not null,
07:38:27  10  	alter_action	     NUMBER(2),
07:38:27  11  	alter_object_type    NUMBER(2),
07:38:27  12  	alter_object_name    VARCHAR2(30),
07:38:27  13  	INDEX_unique	     VARCHAR2(30),
07:38:27  14  	column_name	     VARCHAR2(30),
07:38:27  15  	column_type	     VARCHAR2(30),
07:38:27  16  	column_default	     VARCHAR2(30),
07:38:27  17  	column_nullable      VARCHAR2(30),
07:38:27  18  	constraint_type      NUMBER(2),
07:38:27  19  	table_columns		   VARCHAR2(2000),
07:38:27  20  	parent_table	     VARCHAR2(30),
07:38:27  21  	parent_table_columns VARCHAR2(2000),
07:38:27  22  	status_h	     as (DECODE(TO_CHAR("STATUS"),NULL,NULL,'0','Waiting','1','Done','2','Error','3','Redundent','Unknown')),
07:38:27  23  	action_h	     as (DECODE(TO_CHAR("ACTION"),NULL,NULL,'1','Create','2','Drop','3','Alter',TO_CHAR(4-TO_NUMBER('Rename')),'Unknown')),
07:38:27  24  	object_type_h	     as (DECODE(TO_CHAR("OBJECT_TYPE"),NULL,NULL,'1','Table','2','Index','3','Sequence','Unknown')),
07:38:27  25  	alter_action_h	     as (DECODE(TO_CHAR("ALTER_ACTION"),NULL,NULL,'1','Add','2','Modify','3','Drop','4','Rename','Unknown')),
07:38:27  26  	alter_object_type_h  as (DECODE(TO_CHAR("ALTER_OBJECT_TYPE"),NULL,NULL,'1','column','2','constraint','Unknown')),
07:38:27  27  	constraint_type_h    as (DECODE(TO_CHAR("CONSTRAINT_TYPE"),NULL,NULL,'1','Primary key','2','Foreign key','3','Not null','4','Check','Unknown'))
07:38:27  28  );

Table created.

Elapsed: 00:00:00.02
07:38:27 SQL> CREATE UNIQUE INDEX PK_UPGRADE_STEPS ON UPGRADE_STEPS (ID);

Index created.

Elapsed: 00:00:00.01
07:38:27 SQL> ALTER TABLE UPGRADE_STEPS ADD CONSTRAINT PK_UPGRADE_STEPS PRIMARY KEY (ID) USING INDEX;

Table altered.

Elapsed: 00:00:00.01
07:38:27 SQL> 
07:38:27 SQL> -- Add comments to the columns
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.ID			      IS 'Primary key. Use sequence SEQ_UPGRADE_STEPS';

Comment created.

Elapsed: 00:00:00.01
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.STATUS			      IS '0 - Waiting, 1 - Done, 2- Error';

Comment created.

Elapsed: 00:00:00.00
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.ACTION			      IS '1 - Create, 2 - Drop, 3 - Alter';

Comment created.

Elapsed: 00:00:00.00
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.OBJECT_TYPE	      IS '1 - Table, 2 - Index, 3 - Sequence';

Comment created.

Elapsed: 00:00:00.01
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.ALTER_ACTION	      IS '1 - Add, 2 - Modify, 3 - Drop';

Comment created.

Elapsed: 00:00:00.00
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.ALTER_OBJECT_TYPE	IS '1 - column, 2 - constraint';

Comment created.

Elapsed: 00:00:00.00
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.ALTER_OBJECT_NAME	IS 'Name for added column / constraint';

Comment created.

Elapsed: 00:00:00.00
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.CONSTRAINT_TYPE	      IS '1 - Primary key, 2 - Foreign key, 3 - Not null, 4 - Check';

Comment created.

Elapsed: 00:00:00.01
07:38:27 SQL> COMMENT ON COLUMN UPGRADE_STEPS.TABLE_COLUMNS	      IS 'Column list on created / altered table / index';

Comment created.

Elapsed: 00:00:00.00
07:38:27 SQL> -- Create/Recreate check constraints
07:38:27 SQL> ALTER TABLE UPGRADE_STEPS ADD CONSTRAINT CHECK_ALTER  CHECK (ALTER_ACTION IS NULL OR (ALTER_ACTION IS NOT NULL AND ALTER_OBJECT_TYPE IS NOT NULL ));

Table altered.

Elapsed: 00:00:00.04
07:38:27 SQL> 
07:38:27 SQL> 
07:38:27 SQL> CREATE OR REPLACE PACKAGE EBS_UPLOAD_UTILS AS
07:38:27   2  /*************
07:38:27   3  CONSTANTS
07:38:27   4  *************/
07:38:27   5  	      C_OBJECT_TYPE_TABLE     NUMBER := 1;
07:38:27   6  	      C_OBJECT_TYPE_INDEX     NUMBER := 2;
07:38:27   7  	      C_OBJECT_TYPE_SEQUENCE  NUMBER := 3;
07:38:27   8  	      C_OBJECT_TYPE_PACKAGE   NUMBER := 4;
07:38:27   9  	      C_OBJECT_TYPE_PROCEDURE NUMBER := 5;
07:38:27  10  	      C_OBJECT_TYPE_FUNCTION  NUMBER := 6;
07:38:27  11  	      C_OBJECT_TYPE_VIEW      NUMBER := 7;
07:38:27  12  	      C_OBJECT_TYPE_MVIEW     NUMBER := 8;
07:38:27  13  
07:38:27  14  	C_VERSION_START 	NUMBER :=0;
07:38:27  15  	C_VERSION_END_OK	NUMBER :=1;
07:38:27  16  	C_VERSION_END_FAILURE	NUMBER :=-1;
07:38:27  17  
07:38:27  18  /*************
07:38:27  19  PROCEDURES
07:38:27  20  *************/
07:38:27  21  	      PROCEDURE alterFKsReferringTable(pAction	      IN VARCHAR2,
07:38:27  22  									       pTable IN VARCHAR2,
07:38:27  23  									       pOwner IN VARCHAR2 DEFAULT USER);
07:38:27  24  	      PROCEDURE VERSION_UPLOAD_STATUS(P_APPLICATION VARCHAR2,
07:38:27  25  									       P_MAJOR		NUMBER,
07:38:27  26  									       P_MINOR		NUMBER,
07:38:27  27  									       P_PATCH		NUMBER,
07:38:27  28  									       P_BUILD		NUMBER,
07:38:27  29  									       P_STATUS 	VARCHAR2,
07:38:27  30  									       P_COMMENT	VARCHAR2);
07:38:27  31  	      PROCEDURE EXECUTE_ALL /* threading, where clause */     ;
07:38:27  32  	      PROCEDURE EXECUTE_TABLE(P_TABLE_NAME VARCHAR2);
07:38:27  33  	      PROCEDURE ADD_COLUMN(P_TABLE_NAME       VARCHAR2,
07:38:27  34  						       P_COLUMN_NAME  VARCHAR2,
07:38:27  35  						       P_COLUMN_TYPE  VARCHAR2,
07:38:27  36  						       P_NULLABLE     VARCHAR2,
07:38:27  37  						       P_DEFAULT	      VARCHAR2);
07:38:27  38  	      PROCEDURE DROP_COLUMN(P_TABLE_NAME      VARCHAR2,
07:38:27  39  							P_COLUMN_NAME VARCHAR2);
07:38:27  40  	      PROCEDURE MODIFY_COLUMN(P_TABLE_NAME  VARCHAR2,
07:38:27  41  				      P_COLUMN_NAME VARCHAR2,
07:38:27  42  							      P_COLUMN_TYPE VARCHAR2,
07:38:27  43  							      P_NULLABLE	VARCHAR2,
07:38:27  44  							      P_DEFAULT 	VARCHAR2);
07:38:27  45  	      PROCEDURE CREATE_INDEX(P_TABLE_NAME VARCHAR2,
07:38:27  46  							 P_INDEX_NAME VARCHAR2,
07:38:27  47  							 P_COLUMNS    VARCHAR2,
07:38:27  48  							 P_UNIQUE     NUMBER);
07:38:27  49  	      PROCEDURE DROP_OBJECT(P_OBJECT_TYPE VARCHAR2,
07:38:27  50  							P_OBJECT_NAME VARCHAR2);
07:38:27  51  /*
07:38:27  52  	      PROCEDURE DROP_INDEX(P_INDEX_NAME VARCHAR2);
07:38:27  53  	      PROCEDURE DROP_CONSTRAINT(P_TABLE_NAME	      VARCHAR2,
07:38:27  54  								P_CONSTRAINT_NAME VARCHAR2);
07:38:27  55  	      PROCEDURE DROP_PKG(P_PKG_NAME VARCHAR2);
07:38:27  56  	      PROCEDURE DROP_PROCEDURE(P_PROCEDURE_NAME VARCHAR2);
07:38:27  57  	      PROCEDURE DROP_FUNCTION(P_FUNCTION_NAME VARCHAR2);
07:38:27  58  	      PROCEDURE DROP_SEQUENCE(P_SEQUENCE_NAME VARCHAR2);
07:38:27  59  	      PROCEDURE DROP_VIEW(P_VIEW_NAME VARCHAR2);
07:38:27  60  	      PROCEDURE DROP_MVIEW(P_MVIEW_NAME VARCHAR2);
07:38:27  61  	      PnROCEDURE DROP_TABLE(P_TABLE_NAME VARCHAR2);
07:38:27  62  */
07:38:27  63  END;
07:38:27  64  /

Package created.

Elapsed: 00:00:00.73
07:38:28 SQL> 
07:38:28 SQL> show errors
No errors.
07:38:28 SQL> 
07:38:28 SQL> CREATE OR REPLACE PACKAGE BODY EBS_UPLOAD_UTILS AS
07:38:28   2  /*************
07:38:28   3  CONSTANTS
07:38:28   4  *************/
07:38:28   5  	      C_STATUS_WAITING NUMBER := 0;
07:38:28   6  	      C_STATUS_DONE    NUMBER := 1;
07:38:28   7  	      C_STATUS_ERROR   NUMBER := 2;
07:38:28   8  	      C_STATUS_Redundent NUMBER := 3;
07:38:28   9  
07:38:28  10  	      C_ACTION_CREATE NUMBER := 1;
07:38:28  11  	      C_ACTION_DROP   NUMBER := 2;
07:38:28  12  	      C_ACTION_ALTER  NUMBER := 3;
07:38:28  13  
07:38:28  14  	      C_ALTER_ACTION_ADD    NUMBER := 1;
07:38:28  15  	      C_ALTER_ACTION_MODIFY NUMBER := 2;
07:38:28  16  	      C_ALTER_ACTION_DROP   NUMBER := 3;
07:38:28  17  
07:38:28  18  	      C_ALTER_OBJECT_TYPE_COLUMN     NUMBER := 1;
07:38:28  19  	      C_ALTER_OBJECT_TYPE_CONSTRAINT NUMBER := 2;
07:38:28  20  
07:38:28  21  	      -- Refactored procedure SANITIZE
07:38:28  22  	      FUNCTION SANITIZE(P_PARAM IN VARCHAR2) RETURN VARCHAR2 IS
07:38:28  23  	      BEGIN
07:38:28  24  		      RETURN REPLACE(UPPER(P_PARAM),' ','');
07:38:28  25  	      END SANITIZE;
07:38:28  26  
07:38:28  27  	      PROCEDURE alterFKsReferringTable(pAction IN VARCHAR2,
07:38:28  28  									       pTable IN VARCHAR2,
07:38:28  29  									       pOwner IN VARCHAR2 DEFAULT USER)
07:38:28  30  	      AS
07:38:28  31  		      CURSOR FKList(lpOwner IN VARCHAR2, lpTable IN VARCHAR2, lpAction IN VARCHAR2) IS
07:38:28  32  		      -- Generate 'ALTER TABLE table_name DISABLE/ENABLE  CONSTRAINT' SQLs
07:38:28  33  			      SELECT 'ALTER TABLE ' || FK.OWNER || '.' || FK.TABLE_NAME || ' ' || LPACTION ||' CONSTRAINT ' || FK.CONSTRAINT_NAME AS ALTERFK
07:38:28  34  			      FROM   ALL_CONSTRAINTS FK,
07:38:28  35  					 ALL_INDEXES	 IDX
07:38:28  36  			      WHERE  FK.CONSTRAINT_TYPE = 'R'
07:38:28  37  				AND  IDX.TABLE_OWNER LIKE LPOWNER
07:38:28  38  				AND  IDX.TABLE_NAME LIKE LPTABLE
07:38:28  39  				AND  FK.R_CONSTRAINT_NAME = IDX.INDEX_NAME
07:38:28  40  				AND  FK.R_OWNER = IDX.TABLE_OWNER
07:38:28  41  			      ORDER  BY 1;
07:38:28  42  	      BEGIN /*alterFKsReferringTable*/
07:38:28  43  		      FOR FK IN FKList(SANITIZE(pOwner), SANITIZE(pTable), SANITIZE(pAction)) LOOP /* FKs */
07:38:28  44  			      BEGIN/* alter FK */
07:38:28  45  				      EXECUTE IMMEDIATE FK.ALTERFK; -- TODO: Write to log
07:38:28  46  			      EXCEPTION
07:38:28  47  				      WHEN OTHERS THEN NULL;
07:38:28  48  			      END /* alter FK */;
07:38:28  49  		      END LOOP /* FKs */;
07:38:28  50  	      END ALTERFKSREFERRINGTABLE;
07:38:28  51  
07:38:28  52  	      PROCEDURE VERSION_UPLOAD_STATUS(P_APPLICATION VARCHAR2,
07:38:28  53  									      P_MAJOR		NUMBER,
07:38:28  54  									      P_MINOR		NUMBER,
07:38:28  55  									      P_PATCH		NUMBER,
07:38:28  56  									      P_BUILD		NUMBER,
07:38:28  57  									      P_STATUS		VARCHAR2,
07:38:28  58  									      P_COMMENT 	VARCHAR2)
07:38:28  59  	      AS
07:38:28  60  		      lLastVersionStatus LOG_UPLOADS.status%type;
07:38:28  61  		      lLastVersionID	 LOG_UPLOADS.ID%type;
07:38:28  62  		      lNextID		 LOG_UPLOADS.ID%type;
07:38:28  63  	      BEGIN
07:38:28  64  		      -- Find latest version  record if exists.
07:38:28  65  		      select MAX(sv.id), MAX(sv.status) into lLastVersionID, lLastVersionStatus
07:38:28  66  		      from LOG_UPLOADS sv
07:38:28  67  		      where P_MAJOR = sv.major
07:38:28  68  			and P_MINOR = sv.minor
07:38:28  69  			and P_PATCH = sv.patch
07:38:28  70  			and P_BUILD = sv.build;
07:38:28  71  
07:38:28  72  		      --Get next ID
07:38:28  73  		      select max(id)+1 into lNextID from LOG_UPLOADS ;
07:38:28  74  		      if (lNextID is null) then
07:38:28  75  			lNextID := 1;
07:38:28  76  		      end if;
07:38:28  77  
07:38:28  78  		      if (P_STATUS = C_VERSION_START and lLastVersionStatus is null)  then
07:38:28  79  			-- First time the version is executed
07:38:28  80  			insert into LOG_UPLOADS(id, Application, Major, Minor, Patch, Build, Status, Comments)
07:38:28  81  			  values (lNextID ,P_APPLICATION, P_MAJOR, P_MINOR, P_PATCH, P_BUILD, P_STATUS, P_COMMENT);
07:38:28  82  
07:38:28  83  		      elsif (P_STATUS = C_VERSION_END_OK and lLastVersionStatus = C_VERSION_START) then
07:38:28  84  			-- Close "OK" current version
07:38:28  85  			update LOG_UPLOADS set
07:38:28  86  			      Status = C_VERSION_END_OK,
07:38:28  87  			      End_time = sysdate
07:38:28  88  			where id = lLastVersionID;
07:38:28  89  
07:38:28  90  		  elsif ((P_STATUS = C_VERSION_START or P_STATUS = C_VERSION_END_OK) and lLastVersionStatus = C_VERSION_END_OK) then
07:38:28  91  			-- Version already uploaded, do not migrate again
07:38:28  92  			raise_application_error(-20001, 'Upload '||P_APPLICATION||' - '||P_MAJOR||'.'||P_MINOR||'.'||P_PATCH||'.'||P_BUILD||' already applied');
07:38:28  93  
07:38:28  94  		      elsif (P_STATUS = C_VERSION_START and lLastVersionStatus = C_VERSION_START) then
07:38:28  95  			-- Try to rerun the upgrade after run failure
07:38:28  96  			update LOG_UPLOADS set
07:38:28  97  			      Status = C_VERSION_END_FAILURE,
07:38:28  98  			      End_time = sysdate
07:38:28  99  			where id = lLastVersionID;
07:38:28 100  			insert into LOG_UPLOADS(id, Application, Major, Minor, Patch, Build, Status, Comments)
07:38:28 101  			  values (lNextID ,P_APPLICATION, P_MAJOR, P_MINOR, P_PATCH, P_BUILD, P_STATUS, P_COMMENT);
07:38:28 102  
07:38:28 103  		      elsif (P_STATUS = C_VERSION_START and lLastVersionStatus = C_VERSION_END_OK) then
07:38:28 104  			-- Try ending a none-existing version
07:38:28 105  			raise_application_error(-20002, 'No such upload to end');
07:38:28 106  
07:38:28 107  		      end if;
07:38:28 108  		      commit;
07:38:28 109  	      END;
07:38:28 110  
07:38:28 111  
07:38:28 112  	      PROCEDURE UPDATE_STEP_STATUS(P_STEP_ID NUMBER, P_STATUS NUMBER, P_SQLERRM VARCHAR2 DEFAULT NULL) IS
07:38:28 113  	      BEGIN
07:38:28 114  		      UPDATE UPGRADE_STEPS T
07:38:28 115  		      SET    T.STATUS = P_STATUS, T.ERROR_MESSAGE = P_SQLERRM
07:38:28 116  		      WHERE  T.ID = P_STEP_ID;
07:38:28 117  		      COMMIT;
07:38:28 118  	      END;
07:38:28 119  
07:38:28 120  	      -- Refactored procedure get_index_name_by_columns
07:38:28 121  	      PROCEDURE GET_INDEX_NAME_BY_COLUMNS(P_TABLE_NAME IN VARCHAR2, L_COLUMNS IN VARCHAR2,
07:38:28 122  																			      L_EXISTING_INDEX_NAME IN OUT VARCHAR2) IS
07:38:28 123  	      BEGIN
07:38:28 124  		      SELECT INDEX_NAME
07:38:28 125  		      INTO   L_EXISTING_INDEX_NAME
07:38:28 126  		      FROM   (SELECT INDEX_NAME, LISTAGG(T.COLUMN_NAME,',') WITHIN GROUP(ORDER BY T.COLUMN_POSITION) COLUMNS
07:38:28 127  				      FROM   USER_IND_COLUMNS T
07:38:28 128  				      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 129  				      GROUP  BY INDEX_NAME) T2
07:38:28 130  		      WHERE  T2.COLUMNS = L_COLUMNS;
07:38:28 131  	      END GET_INDEX_NAME_BY_COLUMNS;
07:38:28 132  
07:38:28 133  	      -- Refactored procedure get_uniquness_clause
07:38:28 134  	      PROCEDURE GET_UNIQUNESS_CLAUSE(P_UNIQUE IN NUMBER, L_UNIQUENESS IN OUT VARCHAR2) IS
07:38:28 135  	      BEGIN
07:38:28 136  		      IF P_UNIQUE = 1 THEN
07:38:28 137  			      L_UNIQUENESS := 'UNIQUE';
07:38:28 138  		      END IF;
07:38:28 139  	      END GET_UNIQUNESS_CLAUSE;
07:38:28 140  	      -- Refactored procedure get_nullable_for_col
07:38:28 141  	      PROCEDURE GET_NULLABLE_FOR_COL(P_TABLE_NAME IN VARCHAR2, P_COLUMN_NAME IN VARCHAR2,
07:38:28 142  																       L_NULLABLE IN OUT USER_TAB_COLUMNS.NULLABLE%TYPE) IS
07:38:28 143  	      BEGIN
07:38:28 144  		      SELECT NULLABLE
07:38:28 145  		      INTO   L_NULLABLE
07:38:28 146  		      FROM   USER_TAB_COLUMNS T
07:38:28 147  		      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 148  		      AND    T.COLUMN_NAME = P_COLUMN_NAME;
07:38:28 149  	      END GET_NULLABLE_FOR_COL;
07:38:28 150  
07:38:28 151  	      FUNCTION GET_NULL_CLAUSE_FROM_Y_N(P_NULLABLE VARCHAR2) RETURN VARCHAR2 IS
07:38:28 152  	      BEGIN
07:38:28 153  
07:38:28 154  		      IF P_NULLABLE = 'Y' THEN
07:38:28 155  			      RETURN('null');
07:38:28 156  		      ELSIF P_NULLABLE = 'N' THEN
07:38:28 157  			      RETURN('not null');
07:38:28 158  		      ELSE
07:38:28 159  			      RAISE_APPLICATION_ERROR(-20001,
07:38:28 160  															      'Y/N expected');
07:38:28 161  		      END IF;
07:38:28 162  	      END GET_NULL_CLAUSE_FROM_Y_N;
07:38:28 163  
07:38:28 164  	      FUNCTION GET_DEFAULT_CLAUSE_FOR_VALUE(P_DEFAULT VARCHAR2) RETURN VARCHAR2 IS
07:38:28 165  	      BEGIN
07:38:28 166  		      IF P_DEFAULT IS NULL THEN
07:38:28 167  			      RETURN('');
07:38:28 168  		      ELSIF P_DEFAULT IS NOT NULL THEN
07:38:28 169  			      RETURN('default ' || P_DEFAULT);
07:38:28 170  		      END IF;
07:38:28 171  	      END GET_DEFAULT_CLAUSE_FOR_VALUE;
07:38:28 172  
07:38:28 173  	      -- Refactored procedure get_user_ind_uniqueness
07:38:28 174  	      PROCEDURE GET_USER_IND_UNIQUENESS(P_UNIQUE IN NUMBER, L_USER_IND_UNIQUE IN OUT VARCHAR2) IS
07:38:28 175  	      BEGIN
07:38:28 176  		      IF P_UNIQUE = 1 THEN
07:38:28 177  			      L_USER_IND_UNIQUE := 'UNIQUE';
07:38:28 178  		      ELSE
07:38:28 179  			      L_USER_IND_UNIQUE := 'NONUNIQUE';
07:38:28 180  		      END IF;
07:38:28 181  	      END GET_USER_IND_UNIQUENESS;
07:38:28 182  	      /*
07:38:28 183  
07:38:28 184  
07:38:28 185  	     exists functions
07:38:28 186  
07:38:28 187  	*/
07:38:28 188  
07:38:28 189  	      -- Refactored procedure exists_index_with_columns
07:38:28 190  	      PROCEDURE EXISTS_INDEX_WITH_COLUMNS(P_TABLE_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER,
07:38:28 191  																			      L_COLUMNS IN VARCHAR2) IS
07:38:28 192  	      BEGIN
07:38:28 193  		      SELECT COUNT(*)
07:38:28 194  		      INTO   L_EXISTS
07:38:28 195  		      FROM   (SELECT INDEX_NAME,
07:38:28 196  									       LISTAGG(T.COLUMN_NAME,
07:38:28 197  													       ',') WITHIN GROUP(ORDER BY T.COLUMN_POSITION) COLUMNS
07:38:28 198  						      FROM   USER_IND_COLUMNS T
07:38:28 199  						      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 200  						      GROUP  BY INDEX_NAME) T2
07:38:28 201  		      WHERE  T2.COLUMNS = L_COLUMNS
07:38:28 202  		      and rownum < 2;
07:38:28 203  	      END EXISTS_INDEX_WITH_COLUMNS;
07:38:28 204  
07:38:28 205  	      PROCEDURE EXISTS_INDEX_WITH_NAME(P_INDEX_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 206  	      BEGIN
07:38:28 207  		      SELECT COUNT(*)
07:38:28 208  		      INTO   L_EXISTS
07:38:28 209  		      FROM   USER_INDEXES T
07:38:28 210  
07:38:28 211  		      WHERE  T.INDEX_NAME = P_INDEX_NAME
07:38:28 212  		      and rownum < 2;
07:38:28 213  	      END EXISTS_INDEX_WITH_NAME;
07:38:28 214  
07:38:28 215  	      -- Refactored procedure exists_index_with_collumns_and_uniqueness
07:38:28 216  	      PROCEDURE EXISTS_INDEX_WITH_COLS_UNIQUE(P_TABLE_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER,
07:38:28 217  																					      L_COLUMNS IN VARCHAR2, L_UNIQUENESS IN VARCHAR2) IS
07:38:28 218  	      BEGIN
07:38:28 219  		      SELECT COUNT(*)
07:38:28 220  		      INTO   L_EXISTS
07:38:28 221  		      FROM   (SELECT T2.INDEX_NAME,
07:38:28 222  									       T2.UNIQUENESS,
07:38:28 223  									       LISTAGG(T.COLUMN_NAME,
07:38:28 224  													       ',') WITHIN GROUP(ORDER BY T.COLUMN_POSITION) COLUMNS
07:38:28 225  						      FROM   USER_IND_COLUMNS T
07:38:28 226  						      JOIN   USER_INDEXES T2 ON (T.INDEX_NAME = T2.INDEX_NAME)
07:38:28 227  						      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 228  						      GROUP  BY T2.INDEX_NAME,
07:38:28 229  											      T2.UNIQUENESS) T2
07:38:28 230  		      WHERE  T2.COLUMNS = L_COLUMNS
07:38:28 231  		      AND    T2.UNIQUENESS = L_UNIQUENESS
07:38:28 232  		      and rownum < 2;
07:38:28 233  	      END EXISTS_INDEX_WITH_COLS_UNIQUE;
07:38:28 234  
07:38:28 235  	      -- Refactored procedure exists_index_with_collumns_and_uniqueness
07:38:28 236  	      PROCEDURE EXISTS_INDEX_COLS_UNIQUE_NAME(P_TABLE_NAME IN VARCHAR2, P_INDEX_NAME IN VARCHAR2,
07:38:28 237  																					      L_EXISTS IN OUT NUMBER, L_COLUMNS IN VARCHAR2,
07:38:28 238  																					      L_UNIQUENESS IN VARCHAR2) IS
07:38:28 239  	      BEGIN
07:38:28 240  		      SELECT COUNT(*)
07:38:28 241  		      INTO   L_EXISTS
07:38:28 242  		      FROM   (SELECT T2.INDEX_NAME,
07:38:28 243  									       T2.UNIQUENESS,
07:38:28 244  									       LISTAGG(T.COLUMN_NAME,
07:38:28 245  													       ',') WITHIN GROUP(ORDER BY T.COLUMN_POSITION) COLUMNS
07:38:28 246  						      FROM   USER_IND_COLUMNS T
07:38:28 247  						      JOIN   USER_INDEXES T2 ON (T.INDEX_NAME = T2.INDEX_NAME)
07:38:28 248  						      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 249  						      AND    T.INDEX_NAME = P_INDEX_NAME
07:38:28 250  						      GROUP  BY T2.INDEX_NAME,
07:38:28 251  											      T2.UNIQUENESS) T2
07:38:28 252  		      WHERE  T2.COLUMNS = L_COLUMNS
07:38:28 253  		      AND    T2.UNIQUENESS = L_UNIQUENESS
07:38:28 254  		      and rownum < 2;
07:38:28 255  	      END EXISTS_INDEX_COLS_UNIQUE_NAME;
07:38:28 256  
07:38:28 257  	      -- Refactored procedure exists_col_by_table_and_name
07:38:28 258  	      PROCEDURE EXISTS_COL_BY_TABLE_AND_NAME(P_TABLE_NAME IN VARCHAR2, P_COLUMN_NAME IN VARCHAR2,
07:38:28 259  																				       L_EXISTS IN OUT NUMBER) IS
07:38:28 260  	      BEGIN
07:38:28 261  		      SELECT COUNT(*)
07:38:28 262  		      INTO   L_EXISTS
07:38:28 263  		      FROM   USER_TAB_COLUMNS T
07:38:28 264  		      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 265  		      AND    T.COLUMN_NAME = P_COLUMN_NAME
07:38:28 266  		      and rownum < 2;
07:38:28 267  	      END EXISTS_COL_BY_TABLE_AND_NAME;
07:38:28 268  
07:38:28 269  	      -- Refactored procedure exists_col_by_table_and_name
07:38:28 270  	      PROCEDURE EXISTS_CONS_BY_TABLE_AND_NAME(P_TABLE_NAME IN VARCHAR2, P_CONSTRAINT_NAME IN VARCHAR2,
07:38:28 271  																					      L_EXISTS IN OUT NUMBER) IS
07:38:28 272  	      BEGIN
07:38:28 273  		      SELECT COUNT(*)
07:38:28 274  		      INTO   L_EXISTS
07:38:28 275  		      FROM   USER_CONSTRAINTS T
07:38:28 276  		      WHERE  T.TABLE_NAME = P_TABLE_NAME
07:38:28 277  		      AND    T.CONSTRAINT_NAME = P_CONSTRAINT_NAME
07:38:28 278  		      and rownum < 2;
07:38:28 279  	      END EXISTS_CONS_BY_TABLE_AND_NAME;
07:38:28 280  
07:38:28 281  	      PROCEDURE EXISTS_PKG_WITH_NAME(P_PKG_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 282  	      BEGIN
07:38:28 283  		      SELECT COUNT(*)
07:38:28 284  		      INTO   L_EXISTS
07:38:28 285  		      FROM   USER_PROCEDURES T
07:38:28 286  		      WHERE  T.OBJECT_NAME = P_PKG_NAME
07:38:28 287  		      AND    T.OBJECT_TYPE = 'PACKAGE'
07:38:28 288  		      and rownum < 2;
07:38:28 289  	      END EXISTS_PKG_WITH_NAME;
07:38:28 290  
07:38:28 291  	      PROCEDURE EXISTS_PROCEDURE_WITH_NAME(P_PROCEDURE_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 292  	      BEGIN
07:38:28 293  		      SELECT COUNT(*)
07:38:28 294  		      INTO   L_EXISTS
07:38:28 295  		      FROM   USER_PROCEDURES T
07:38:28 296  		      WHERE  T.OBJECT_NAME = P_PROCEDURE_NAME
07:38:28 297  		      AND    T.OBJECT_TYPE = 'PROCEDURE'
07:38:28 298  		      and rownum < 2;
07:38:28 299  	      END EXISTS_PROCEDURE_WITH_NAME;
07:38:28 300  
07:38:28 301  	      PROCEDURE EXISTS_FUNCTION_WITH_NAME(P_FUNCTION_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 302  	      BEGIN
07:38:28 303  		      SELECT COUNT(*)
07:38:28 304  		      INTO   L_EXISTS
07:38:28 305  		      FROM   USER_PROCEDURES T
07:38:28 306  		      WHERE  T.OBJECT_NAME = P_FUNCTION_NAME
07:38:28 307  		      AND    T.OBJECT_TYPE = 'FUNCTION'
07:38:28 308  		      and rownum < 2;
07:38:28 309  	      END EXISTS_FUNCTION_WITH_NAME;
07:38:28 310  
07:38:28 311  	      PROCEDURE EXISTS_SEQUENCE_WITH_NAME(P_SEQUENCE_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 312  	      BEGIN
07:38:28 313  		      SELECT COUNT(*)
07:38:28 314  		      INTO   L_EXISTS
07:38:28 315  		      FROM   USER_SEQUENCES T
07:38:28 316  		      WHERE  T.SEQUENCE_NAME = P_SEQUENCE_NAME
07:38:28 317  		      and rownum < 2;
07:38:28 318  	      END EXISTS_SEQUENCE_WITH_NAME;
07:38:28 319  
07:38:28 320  	      /*
07:38:28 321  
07:38:28 322  	     execute immediate procedures
07:38:28 323  
07:38:28 324  	*/
07:38:28 325  
07:38:28 326  	      -- Refactored procedure execute_rename_index
07:38:28 327  	      PROCEDURE EXECUTE_RENAME_INDEX(P_INDEX_NAME IN VARCHAR2, L_EXISTING_INDEX_NAME IN OUT VARCHAR2) IS
07:38:28 328  		      L_STATEMENT VARCHAR2(32767);
07:38:28 329  	      BEGIN
07:38:28 330  		      L_STATEMENT := 'alter index ' || L_EXISTING_INDEX_NAME || ' rename to ' || P_INDEX_NAME;
07:38:28 331  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 332  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 333  	      END EXECUTE_RENAME_INDEX;
07:38:28 334  
07:38:28 335  	      -- Refactored procedure execute_create_index
07:38:28 336  	      PROCEDURE EXECUTE_CREATE_INDEX(P_TABLE_NAME IN VARCHAR2, P_INDEX_NAME IN VARCHAR2,
07:38:28 337  																       L_COLUMNS IN VARCHAR2, L_UNIQUENESS IN OUT VARCHAR2) IS
07:38:28 338  		      L_STATEMENT VARCHAR2(32767);
07:38:28 339  	      BEGIN
07:38:28 340  		      L_STATEMENT := 'create ' || L_UNIQUENESS || ' index ' || P_INDEX_NAME || ' on ' || P_TABLE_NAME || '(' ||
07:38:28 341  									       L_COLUMNS || ')';
07:38:28 342  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 343  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 344  	      END EXECUTE_CREATE_INDEX;
07:38:28 345  
07:38:28 346  	      -- Refactored procedure execute_drop_index
07:38:28 347  	      PROCEDURE EXECUTE_DROP_INDEX(P_INDEX_NAME IN VARCHAR2) IS
07:38:28 348  		      L_STATEMENT VARCHAR2(32767);
07:38:28 349  	      BEGIN
07:38:28 350  		      L_STATEMENT := 'drop index ' || P_INDEX_NAME;
07:38:28 351  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 352  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 353  	      END EXECUTE_DROP_INDEX;
07:38:28 354  
07:38:28 355  	      -- Refactored procedure execute_modify_column
07:38:28 356  	      PROCEDURE EXECUTE_MODIFY_COLUMN(P_TABLE_NAME IN VARCHAR2, P_COLUMN_NAME IN VARCHAR2,
07:38:28 357  																	      P_COLUMN_TYPE IN VARCHAR2, P_DEFAULT IN VARCHAR2,
07:38:28 358  																	      L_NULL_CLAUSE IN OUT VARCHAR2) IS
07:38:28 359  		      L_STATEMENT VARCHAR2(32767);
07:38:28 360  	      BEGIN
07:38:28 361  		      L_STATEMENT := 'alter table ' || P_TABLE_NAME || ' modify ' || P_COLUMN_NAME || ' ' ||
07:38:28 362  									       P_COLUMN_TYPE || ' ' || GET_DEFAULT_CLAUSE_FOR_VALUE(P_DEFAULT) || ' ' ||
07:38:28 363  									       L_NULL_CLAUSE /* null / not null*/
07:38:28 364  		       ;
07:38:28 365  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 366  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 367  	      END EXECUTE_MODIFY_COLUMN;
07:38:28 368  
07:38:28 369  	      -- Refactored procedure execute_modify_column
07:38:28 370  	      PROCEDURE EXECUTE_ADD_COLUMN(P_TABLE_NAME IN VARCHAR2, P_COLUMN_NAME IN VARCHAR2,
07:38:28 371  															       P_COLUMN_TYPE IN VARCHAR2, P_DEFAULT IN VARCHAR2,
07:38:28 372  															       L_NULL_CLAUSE IN OUT VARCHAR2) IS
07:38:28 373  		      L_STATEMENT VARCHAR2(32767);
07:38:28 374  	      BEGIN
07:38:28 375  
07:38:28 376  		      L_STATEMENT := 'alter table ' || P_TABLE_NAME || ' add ' || P_COLUMN_NAME || ' ' ||
07:38:28 377  									       P_COLUMN_TYPE || ' ' || GET_DEFAULT_CLAUSE_FOR_VALUE(P_DEFAULT) || ' ' ||
07:38:28 378  									       L_NULL_CLAUSE /* null / not null*/
07:38:28 379  		       ;
07:38:28 380  
07:38:28 381  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 382  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 383  	      END EXECUTE_ADD_COLUMN;
07:38:28 384  
07:38:28 385  	      -- Refactored procedure execute_drop_column
07:38:28 386  	      PROCEDURE EXECUTE_DROP_COLUMN(P_TABLE_NAME IN VARCHAR2, P_COLUMN_NAME IN VARCHAR2) IS
07:38:28 387  		      L_STATEMENT VARCHAR2(32767);
07:38:28 388  	      BEGIN
07:38:28 389  
07:38:28 390  		      L_STATEMENT := 'alter table ' || P_TABLE_NAME || ' drop column ' || P_COLUMN_NAME;
07:38:28 391  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 392  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 393  	      END EXECUTE_DROP_COLUMN;
07:38:28 394  
07:38:28 395  	      -- Refactored procedure execute_drop_table
07:38:28 396  	      PROCEDURE EXECUTE_DROP_TABLE(P_TABLE_NAME IN VARCHAR2) IS
07:38:28 397  		      L_STATEMENT VARCHAR2(32767);
07:38:28 398  	      BEGIN
07:38:28 399  
07:38:28 400  		      L_STATEMENT := 'drop table ' || P_TABLE_NAME;
07:38:28 401  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 402  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 403  	      END EXECUTE_DROP_TABLE;
07:38:28 404  
07:38:28 405  	      -- Refactored procedure execute_drop_column
07:38:28 406  	      PROCEDURE EXECUTE_DROP_CONSTRAINT(P_TABLE_NAME IN VARCHAR2, P_CONSTRAINT_NAME IN VARCHAR2) IS
07:38:28 407  		      L_STATEMENT VARCHAR2(32767);
07:38:28 408  	      BEGIN
07:38:28 409  
07:38:28 410  		      L_STATEMENT := 'alter table ' || P_TABLE_NAME || ' drop constraint ' || P_CONSTRAINT_NAME;
07:38:28 411  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 412  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 413  	      END EXECUTE_DROP_CONSTRAINT;
07:38:28 414  
07:38:28 415  	      -- Refactored procedure execute_drop_package
07:38:28 416  	      PROCEDURE EXECUTE_DROP_PKG(P_PKG_NAME IN VARCHAR2) IS
07:38:28 417  		      L_STATEMENT VARCHAR2(32767);
07:38:28 418  	      BEGIN
07:38:28 419  
07:38:28 420  		      L_STATEMENT := 'drop package ' || P_PKG_NAME;
07:38:28 421  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 422  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 423  	      END EXECUTE_DROP_PKG;
07:38:28 424  
07:38:28 425  	      -- Refactored procedure execute_drop_procedure
07:38:28 426  	      PROCEDURE EXECUTE_DROP_PROCEDURE(P_PROCEDURE_NAME IN VARCHAR2) IS
07:38:28 427  		      L_STATEMENT VARCHAR2(32767);
07:38:28 428  	      BEGIN
07:38:28 429  
07:38:28 430  		      L_STATEMENT := 'drop procedure ' || P_PROCEDURE_NAME;
07:38:28 431  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 432  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 433  	      END EXECUTE_DROP_PROCEDURE;
07:38:28 434  
07:38:28 435  	      -- Refactored function execute_drop_function
07:38:28 436  	      PROCEDURE EXECUTE_DROP_FUNCTION(P_FUNCTION_NAME IN VARCHAR2) IS
07:38:28 437  		      L_STATEMENT VARCHAR2(32767);
07:38:28 438  	      BEGIN
07:38:28 439  
07:38:28 440  		      L_STATEMENT := 'drop function ' || P_FUNCTION_NAME;
07:38:28 441  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 442  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 443  	      END EXECUTE_DROP_FUNCTION;
07:38:28 444  
07:38:28 445  	      -- Refactored mview execute_drop_mview
07:38:28 446  	      PROCEDURE EXECUTE_DROP_MVIEW(P_MVIEW_NAME IN VARCHAR2) IS
07:38:28 447  		      L_STATEMENT VARCHAR2(32767);
07:38:28 448  	      BEGIN
07:38:28 449  
07:38:28 450  		      L_STATEMENT := 'drop materialized view ' || P_MVIEW_NAME;
07:38:28 451  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 452  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 453  	      END EXECUTE_DROP_MVIEW;
07:38:28 454  
07:38:28 455  	      -- Refactored function execute_drop_function
07:38:28 456  	      PROCEDURE EXECUTE_DROP_VIEW(P_VIEW_NAME IN VARCHAR2) IS
07:38:28 457  		      L_STATEMENT VARCHAR2(32767);
07:38:28 458  	      BEGIN
07:38:28 459  
07:38:28 460  		      L_STATEMENT := 'drop view ' || P_VIEW_NAME;
07:38:28 461  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 462  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 463  	      END EXECUTE_DROP_VIEW;
07:38:28 464  
07:38:28 465  	      -- Refactored sequence execute_drop_sequence
07:38:28 466  	      PROCEDURE EXECUTE_DROP_SEQUENCE(P_SEQUENCE_NAME IN VARCHAR2) IS
07:38:28 467  		      L_STATEMENT VARCHAR2(32767);
07:38:28 468  	      BEGIN
07:38:28 469  
07:38:28 470  		      L_STATEMENT := 'drop sequence ' || P_SEQUENCE_NAME;
07:38:28 471  		      DBMS_OUTPUT.PUT_LINE('Executed: "' || L_STATEMENT || '"');
07:38:28 472  		      EXECUTE IMMEDIATE L_STATEMENT;
07:38:28 473  	      END EXECUTE_DROP_SEQUENCE;
07:38:28 474  
07:38:28 475  	      PROCEDURE EXISTS_VIEW_WITH_NAME(P_VIEW_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 476  	      BEGIN
07:38:28 477  		      SELECT COUNT(*)
07:38:28 478  		      INTO   L_EXISTS
07:38:28 479  		      FROM   USER_VIEWS T
07:38:28 480  
07:38:28 481  		      WHERE  T.VIEW_NAME = P_VIEW_NAME;
07:38:28 482  	      END EXISTS_VIEW_WITH_NAME;
07:38:28 483  
07:38:28 484  	      PROCEDURE EXISTS_MVIEW_WITH_NAME(P_MVIEW_NAME IN VARCHAR2, L_EXISTS IN OUT NUMBER) IS
07:38:28 485  	      BEGIN
07:38:28 486  		      SELECT COUNT(*)
07:38:28 487  		      INTO   L_EXISTS
07:38:28 488  		      FROM   USER_MVIEWS T
07:38:28 489  
07:38:28 490  		      WHERE  T.MVIEW_NAME = P_MVIEW_NAME;
07:38:28 491  	      END EXISTS_MVIEW_WITH_NAME;
07:38:28 492  	      /*
07:38:28 493  
07:38:28 494  	     safe execution internal procedures
07:38:28 495  
07:38:28 496  	*/
07:38:28 497  
07:38:28 498  	      PROCEDURE SAFE_CREATE_INDEX(P_STEP_ID NUMBER, P_TABLE_NAME VARCHAR2, P_INDEX_NAME VARCHAR2,
07:38:28 499  															      P_COLUMNS VARCHAR2, P_UNIQUE NUMBER) IS
07:38:28 500  		      L_EXISTS_WITH_NAME	   NUMBER(1);
07:38:28 501  		      L_EXISTS_WITH_COLUMNS	   NUMBER(1);
07:38:28 502  		      L_EXISTS_COLUMNS_UNIQUE_NAME NUMBER(1);
07:38:28 503  		      L_EXISTS_WITH_COLUMNS_UNIQUE NUMBER(1);
07:38:28 504  
07:38:28 505  		      L_EXISTING_INDEX_NAME VARCHAR2(30);
07:38:28 506  		      L_UNIQUENESS_CLAUSE   VARCHAR2(30) := '';
07:38:28 507  		      L_USER_IND_UNIQUE     VARCHAR2(30) := '';
07:38:28 508  
07:38:28 509  	      BEGIN
07:38:28 510  
07:38:28 511  		      GET_USER_IND_UNIQUENESS(P_UNIQUE,
07:38:28 512  														      L_USER_IND_UNIQUE);
07:38:28 513  		      GET_UNIQUNESS_CLAUSE(P_UNIQUE,
07:38:28 514  												       L_UNIQUENESS_CLAUSE);
07:38:28 515  
07:38:28 516  		      -- Already exists index with the same name?
07:38:28 517  		      EXISTS_INDEX_WITH_NAME(P_INDEX_NAME,
07:38:28 518  													       L_EXISTS_WITH_NAME);
07:38:28 519  
07:38:28 520  		      /* exists index with same name */
07:38:28 521  		      IF L_EXISTS_WITH_NAME = 1 THEN
07:38:28 522  
07:38:28 523  			      -- Does existing index contain the same solumns in the same order asrequested?
07:38:28 524  			      --
07:38:28 525  			      EXISTS_INDEX_COLS_UNIQUE_NAME(P_TABLE_NAME,
07:38:28 526  																		      P_INDEX_NAME,
07:38:28 527  																		      L_EXISTS_COLUMNS_UNIQUE_NAME,
07:38:28 528  																		      P_COLUMNS,
07:38:28 529  																		      L_USER_IND_UNIQUE);
07:38:28 530  
07:38:28 531  			      /* existing index is with same columns and uniquness and name as requested */
07:38:28 532  			      IF L_EXISTS_COLUMNS_UNIQUE_NAME = 1 THEN
07:38:28 533  
07:38:28 534  				      -- Nothing to do
07:38:28 535  				      NULL;
07:38:28 536  				      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 537  													       C_STATUS_Redundent);
07:38:28 538  
07:38:28 539  				      /* existing index has  columns / column order different than requested */
07:38:28 540  			      ELSE
07:38:28 541  
07:38:28 542  				      -- Drop index
07:38:28 543  				      EXECUTE_DROP_INDEX(P_INDEX_NAME);
07:38:28 544  
07:38:28 545  				      /* with statictics? */
07:38:28 546  				      -- create index with appropriate columns (or rename existing one)
07:38:28 547  				      SAFE_CREATE_INDEX(P_STEP_ID,
07:38:28 548  													      P_TABLE_NAME,
07:38:28 549  													      P_INDEX_NAME,
07:38:28 550  													      P_COLUMNS,
07:38:28 551  													      P_UNIQUE);
07:38:28 552  
07:38:28 553  				      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 554  													       C_STATUS_DONE);
07:38:28 555  			      END IF;
07:38:28 556  
07:38:28 557  			      /* no index with same name */
07:38:28 558  		      ELSE
07:38:28 559  
07:38:28 560  			      /* exists index with same columns? */
07:38:28 561  			      EXISTS_INDEX_WITH_COLUMNS(P_TABLE_NAME,
07:38:28 562  																      L_EXISTS_WITH_COLUMNS,
07:38:28 563  																      P_COLUMNS);
07:38:28 564  
07:38:28 565  			      /* exists index with same columns */
07:38:28 566  			      IF L_EXISTS_WITH_COLUMNS = 1 THEN
07:38:28 567  
07:38:28 568  				      GET_INDEX_NAME_BY_COLUMNS(P_TABLE_NAME,
07:38:28 569  																	      P_COLUMNS,
07:38:28 570  																	      L_EXISTING_INDEX_NAME);
07:38:28 571  
07:38:28 572  				      /* is uniquness the same? */
07:38:28 573  				      EXISTS_INDEX_WITH_COLS_UNIQUE(P_TABLE_NAME,
07:38:28 574  																			      L_EXISTS_WITH_COLUMNS_UNIQUE,
07:38:28 575  																			      P_COLUMNS,
07:38:28 576  																			      L_USER_IND_UNIQUE);
07:38:28 577  
07:38:28 578  				      IF L_EXISTS_WITH_COLUMNS_UNIQUE = 1 THEN
07:38:28 579  
07:38:28 580  					      EXECUTE_RENAME_INDEX(P_INDEX_NAME,
07:38:28 581  															       L_EXISTING_INDEX_NAME);
07:38:28 582  
07:38:28 583  					      /* index columns matching, but uniquness does not match requested */
07:38:28 584  				      ELSE
07:38:28 585  
07:38:28 586  					      -- Drop index
07:38:28 587  					      EXECUTE_DROP_INDEX(L_EXISTING_INDEX_NAME);
07:38:28 588  
07:38:28 589  					      /* with statictics? */
07:38:28 590  					      -- create index with appropriate columns
07:38:28 591  					      EXECUTE_CREATE_INDEX(P_TABLE_NAME,
07:38:28 592  															       P_INDEX_NAME,
07:38:28 593  															       P_COLUMNS,
07:38:28 594  															       L_UNIQUENESS_CLAUSE);
07:38:28 595  
07:38:28 596  				      END IF;
07:38:28 597  
07:38:28 598  				      /* no index with same columns */
07:38:28 599  			      ELSE
07:38:28 600  				      EXECUTE_CREATE_INDEX(P_TABLE_NAME,
07:38:28 601  														       P_INDEX_NAME,
07:38:28 602  														       P_COLUMNS,
07:38:28 603  														       L_UNIQUENESS_CLAUSE);
07:38:28 604  			      END IF;
07:38:28 605  		      END IF;
07:38:28 606  
07:38:28 607  		      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 608  											       C_STATUS_DONE);
07:38:28 609  	      EXCEPTION
07:38:28 610  		      WHEN OTHERS THEN
07:38:28 611  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 612  												       C_STATUS_ERROR,
07:38:28 613  												       SQLERRM);
07:38:28 614  		      RAISE;
07:38:28 615  	      END SAFE_CREATE_INDEX;
07:38:28 616  
07:38:28 617  	      PROCEDURE SAFE_ADD_COLUMN(P_STEP_ID IN NUMBER, P_TABLE_NAME VARCHAR2, P_COLUMN_NAME VARCHAR2,
07:38:28 618  														      P_COLUMN_TYPE VARCHAR2, P_NULLABLE VARCHAR2, P_DEFAULT VARCHAR2) IS
07:38:28 619  		      L_EXISTS	    NUMBER(1);
07:38:28 620  		      L_NULLABLE    USER_TAB_COLUMNS.NULLABLE%TYPE;
07:38:28 621  		      L_NULL_CLAUSE VARCHAR2(10) := '';
07:38:28 622  
07:38:28 623  	      BEGIN
07:38:28 624  
07:38:28 625  		      EXISTS_COL_BY_TABLE_AND_NAME(P_TABLE_NAME,
07:38:28 626  																       P_COLUMN_NAME,
07:38:28 627  																       L_EXISTS);
07:38:28 628  
07:38:28 629  		      /* exists a column with requested name */
07:38:28 630  		      IF L_EXISTS = 1 THEN
07:38:28 631  
07:38:28 632  			      /* select value from "nullable" colmn in user_tab_columns for this column*/
07:38:28 633  			      GET_NULLABLE_FOR_COL(P_TABLE_NAME,
07:38:28 634  													       P_COLUMN_NAME,
07:38:28 635  													       L_NULLABLE);
07:38:28 636  
07:38:28 637  			      /* if current nullable status is different than requested */
07:38:28 638  			      IF L_NULLABLE <> P_NULLABLE THEN
07:38:28 639  
07:38:28 640  				      /* generate a null / not null clause to change it */
07:38:28 641  				      L_NULL_CLAUSE := GET_NULL_CLAUSE_FROM_Y_N(P_NULLABLE);
07:38:28 642  			      END IF;
07:38:28 643  
07:38:28 644  			      EXECUTE_MODIFY_COLUMN(P_TABLE_NAME,
07:38:28 645  														      P_COLUMN_NAME,
07:38:28 646  														      P_COLUMN_TYPE,
07:38:28 647  														      P_DEFAULT,
07:38:28 648  														      L_NULL_CLAUSE);
07:38:28 649  
07:38:28 650  			      /* no column with requested name */
07:38:28 651  		      ELSE
07:38:28 652  
07:38:28 653  			      /* generate a null / not null clause */
07:38:28 654  			      L_NULL_CLAUSE := GET_NULL_CLAUSE_FROM_Y_N(P_NULLABLE);
07:38:28 655  
07:38:28 656  			      EXECUTE_ADD_COLUMN(P_TABLE_NAME,
07:38:28 657  												       P_COLUMN_NAME,
07:38:28 658  												       P_COLUMN_TYPE,
07:38:28 659  												       P_DEFAULT,
07:38:28 660  												       L_NULL_CLAUSE);
07:38:28 661  		      END IF;
07:38:28 662  
07:38:28 663  		      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 664  											       C_STATUS_DONE);
07:38:28 665  	      EXCEPTION
07:38:28 666  		      WHEN OTHERS THEN
07:38:28 667  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 668  												       C_STATUS_ERROR,
07:38:28 669  												       SQLERRM);
07:38:28 670  		      RAISE;
07:38:28 671  	      END SAFE_ADD_COLUMN;
07:38:28 672  
07:38:28 673  	      PROCEDURE SAFE_DROP_INDEX(P_STEP_ID NUMBER, P_INDEX_NAME VARCHAR2) IS
07:38:28 674  		      L_EXISTS NUMBER(1);
07:38:28 675  	      BEGIN
07:38:28 676  
07:38:28 677  		      EXISTS_INDEX_WITH_NAME(P_INDEX_NAME,
07:38:28 678  													       L_EXISTS);
07:38:28 679  
07:38:28 680  		      IF L_EXISTS = 1 THEN
07:38:28 681  
07:38:28 682  			      EXECUTE_DROP_INDEX(P_INDEX_NAME);
07:38:28 683  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 684  												       C_STATUS_DONE);
07:38:28 685  		      ELSE
07:38:28 686  
07:38:28 687  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 688  												       C_STATUS_redundent);
07:38:28 689  		      END IF;
07:38:28 690  	      EXCEPTION
07:38:28 691  		      WHEN OTHERS THEN
07:38:28 692  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 693  												       C_STATUS_ERROR,
07:38:28 694  												       SQLERRM);
07:38:28 695  		      RAISE;
07:38:28 696  	      END SAFE_DROP_INDEX;
07:38:28 697  
07:38:28 698  	      PROCEDURE SAFE_DROP_COLUMN(P_STEP_ID NUMBER, P_TABLE_NAME VARCHAR2, P_COLUMN_NAME VARCHAR2) IS
07:38:28 699  		      L_EXISTS NUMBER(1);
07:38:28 700  
07:38:28 701  	      BEGIN
07:38:28 702  
07:38:28 703  		      EXISTS_COL_BY_TABLE_AND_NAME(P_TABLE_NAME,
07:38:28 704  																       P_COLUMN_NAME,
07:38:28 705  																       L_EXISTS);
07:38:28 706  
07:38:28 707  		      IF L_EXISTS = 1 THEN
07:38:28 708  
07:38:28 709  			      EXECUTE_DROP_COLUMN(P_TABLE_NAME,
07:38:28 710  													      P_COLUMN_NAME);
07:38:28 711  
07:38:28 712  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 713  												       C_STATUS_DONE);
07:38:28 714  		      ELSE
07:38:28 715  
07:38:28 716  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 717  												       C_STATUS_redundent);
07:38:28 718  		      END IF;
07:38:28 719  
07:38:28 720  	      EXCEPTION
07:38:28 721  		      WHEN OTHERS THEN
07:38:28 722  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 723  												       C_STATUS_ERROR,
07:38:28 724  												       SQLERRM);
07:38:28 725  		      RAISE;
07:38:28 726  	      END SAFE_DROP_COLUMN;
07:38:28 727  
07:38:28 728  	      PROCEDURE SAFE_DROP_CONSTRAINT(P_STEP_ID NUMBER, P_TABLE_NAME VARCHAR2,
07:38:28 729  																       P_CONSTRAINT_NAME VARCHAR2) IS
07:38:28 730  		      L_EXISTS NUMBER(1);
07:38:28 731  	      BEGIN
07:38:28 732  		      EXISTS_CONS_BY_TABLE_AND_NAME(P_TABLE_NAME,
07:38:28 733  																	      P_CONSTRAINT_NAME,
07:38:28 734  																	      L_EXISTS);
07:38:28 735  
07:38:28 736  		      IF L_EXISTS = 1 THEN
07:38:28 737  
07:38:28 738  			      EXECUTE_DROP_CONSTRAINT(P_TABLE_NAME,
07:38:28 739  															      P_CONSTRAINT_NAME);
07:38:28 740  
07:38:28 741  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 742  												       C_STATUS_DONE);
07:38:28 743  		      ELSE
07:38:28 744  
07:38:28 745  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 746  												       C_STATUS_redundent);
07:38:28 747  		      END IF;
07:38:28 748  
07:38:28 749  	      EXCEPTION
07:38:28 750  		      WHEN OTHERS THEN
07:38:28 751  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 752  												       C_STATUS_ERROR,
07:38:28 753  												       SQLERRM);
07:38:28 754  		      RAISE;
07:38:28 755  	      END SAFE_DROP_CONSTRAINT;
07:38:28 756  	      PROCEDURE SAFE_DROP_PKG(P_STEP_ID NUMBER, P_PKG_NAME VARCHAR2) IS
07:38:28 757  		      L_EXISTS NUMBER(1);
07:38:28 758  	      BEGIN
07:38:28 759  
07:38:28 760  		      EXISTS_PKG_WITH_NAME(P_PKG_NAME,
07:38:28 761  												       L_EXISTS);
07:38:28 762  
07:38:28 763  		      IF L_EXISTS = 1 THEN
07:38:28 764  
07:38:28 765  			      EXECUTE_DROP_PKG(P_PKG_NAME);
07:38:28 766  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 767  												       C_STATUS_DONE);
07:38:28 768  		      ELSE
07:38:28 769  
07:38:28 770  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 771  												       C_STATUS_redundent);
07:38:28 772  		      END IF;
07:38:28 773  	      EXCEPTION
07:38:28 774  		      WHEN OTHERS THEN
07:38:28 775  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 776  												       C_STATUS_ERROR,
07:38:28 777  												       SQLERRM);
07:38:28 778  		      RAISE;
07:38:28 779  	      END SAFE_DROP_PKG;
07:38:28 780  	      PROCEDURE SAFE_DROP_PROCEDURE(P_STEP_ID NUMBER, P_PROCEDURE_NAME VARCHAR2) IS
07:38:28 781  		      L_EXISTS NUMBER(1);
07:38:28 782  	      BEGIN
07:38:28 783  
07:38:28 784  		      EXISTS_PROCEDURE_WITH_NAME(P_PROCEDURE_NAME,
07:38:28 785  															       L_EXISTS);
07:38:28 786  
07:38:28 787  		      IF L_EXISTS = 1 THEN
07:38:28 788  
07:38:28 789  			      EXECUTE_DROP_PROCEDURE(P_PROCEDURE_NAME);
07:38:28 790  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 791  												       C_STATUS_DONE);
07:38:28 792  		      ELSE
07:38:28 793  
07:38:28 794  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 795  												       C_STATUS_redundent);
07:38:28 796  		      END IF;
07:38:28 797  	      EXCEPTION
07:38:28 798  		      WHEN OTHERS THEN
07:38:28 799  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 800  												       C_STATUS_ERROR,
07:38:28 801  												       SQLERRM);
07:38:28 802  		      RAISE;
07:38:28 803  	      END SAFE_DROP_PROCEDURE;
07:38:28 804  	      PROCEDURE SAFE_DROP_FUNCTION(P_STEP_ID NUMBER, P_FUNCTION_NAME VARCHAR2) IS
07:38:28 805  		      L_EXISTS NUMBER(1);
07:38:28 806  	      BEGIN
07:38:28 807  
07:38:28 808  		      EXISTS_FUNCTION_WITH_NAME(P_FUNCTION_NAME,
07:38:28 809  															      L_EXISTS);
07:38:28 810  
07:38:28 811  		      IF L_EXISTS = 1 THEN
07:38:28 812  
07:38:28 813  			      EXECUTE_DROP_FUNCTION(P_FUNCTION_NAME);
07:38:28 814  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 815  												       C_STATUS_DONE);
07:38:28 816  		      ELSE
07:38:28 817  
07:38:28 818  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 819  												       C_STATUS_redundent);
07:38:28 820  		      END IF;
07:38:28 821  	      EXCEPTION
07:38:28 822  		      WHEN OTHERS THEN
07:38:28 823  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 824  												       C_STATUS_ERROR,
07:38:28 825  												       SQLERRM);
07:38:28 826  		      RAISE;
07:38:28 827  	      END SAFE_DROP_FUNCTION;
07:38:28 828  
07:38:28 829  	      PROCEDURE SAFE_DROP_SEQUENCE(P_STEP_ID NUMBER, P_SEQUENCE_NAME VARCHAR2) IS
07:38:28 830  		      L_EXISTS NUMBER(1);
07:38:28 831  	      BEGIN
07:38:28 832  
07:38:28 833  		      EXISTS_SEQUENCE_WITH_NAME(P_SEQUENCE_NAME,
07:38:28 834  															      L_EXISTS);
07:38:28 835  
07:38:28 836  		      IF L_EXISTS = 1 THEN
07:38:28 837  
07:38:28 838  			      EXECUTE_DROP_SEQUENCE(P_SEQUENCE_NAME);
07:38:28 839  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 840  												       C_STATUS_DONE);
07:38:28 841  		      ELSE
07:38:28 842  
07:38:28 843  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 844  												       C_STATUS_redundent);
07:38:28 845  		      END IF;
07:38:28 846  	      EXCEPTION
07:38:28 847  		      WHEN OTHERS THEN
07:38:28 848  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 849  												       C_STATUS_ERROR,
07:38:28 850  												       SQLERRM);
07:38:28 851  		      RAISE;
07:38:28 852  	      END SAFE_DROP_SEQUENCE;
07:38:28 853  	      PROCEDURE SAFE_DROP_VIEW(P_STEP_ID NUMBER, P_VIEW_NAME VARCHAR2) IS
07:38:28 854  		      L_EXISTS NUMBER(1);
07:38:28 855  	      BEGIN
07:38:28 856  
07:38:28 857  		      EXISTS_VIEW_WITH_NAME(P_VIEW_NAME,
07:38:28 858  													      L_EXISTS);
07:38:28 859  
07:38:28 860  		      IF L_EXISTS = 1 THEN
07:38:28 861  
07:38:28 862  			      EXECUTE_DROP_VIEW(P_VIEW_NAME);
07:38:28 863  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 864  												       C_STATUS_DONE);
07:38:28 865  		      ELSE
07:38:28 866  
07:38:28 867  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 868  												       C_STATUS_redundent);
07:38:28 869  		      END IF;
07:38:28 870  	      EXCEPTION
07:38:28 871  		      WHEN OTHERS THEN
07:38:28 872  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 873  												       C_STATUS_ERROR,
07:38:28 874  												       SQLERRM);
07:38:28 875  		      RAISE;
07:38:28 876  	      END SAFE_DROP_VIEW;
07:38:28 877  	      PROCEDURE SAFE_DROP_MVIEW(P_STEP_ID NUMBER, P_MVIEW_NAME VARCHAR2) IS
07:38:28 878  		      L_EXISTS NUMBER(1);
07:38:28 879  	      BEGIN
07:38:28 880  
07:38:28 881  		      EXISTS_MVIEW_WITH_NAME(P_MVIEW_NAME,
07:38:28 882  													       L_EXISTS);
07:38:28 883  
07:38:28 884  		      IF L_EXISTS = 1 THEN
07:38:28 885  
07:38:28 886  			      EXECUTE_DROP_MVIEW(P_MVIEW_NAME);
07:38:28 887  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 888  												       C_STATUS_DONE);
07:38:28 889  		      ELSE
07:38:28 890  
07:38:28 891  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 892  												       C_STATUS_redundent);
07:38:28 893  		      END IF;
07:38:28 894  	      EXCEPTION
07:38:28 895  		      WHEN OTHERS THEN
07:38:28 896  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 897  												       C_STATUS_ERROR,
07:38:28 898  												       SQLERRM);
07:38:28 899  		      RAISE;
07:38:28 900  	      END SAFE_DROP_MVIEW;
07:38:28 901  
07:38:28 902  	      PROCEDURE SAFE_DROP_TABLE(P_STEP_ID NUMBER, P_TABLE_NAME VARCHAR2) IS
07:38:28 903  		      L_EXISTS NUMBER;
07:38:28 904  
07:38:28 905  	      BEGIN
07:38:28 906  		      SELECT COUNT(*) INTO L_EXISTS FROM USER_TABLES T WHERE T.TABLE_NAME = P_TABLE_NAME;
07:38:28 907  
07:38:28 908  		      IF L_EXISTS = 1 THEN
07:38:28 909  			      ALTERFKSREFERRINGTABLE(PACTION => 'drop',
07:38:28 910  																							      PTABLE  => P_TABLE_NAME);
07:38:28 911  
07:38:28 912  			      EXECUTE_DROP_TABLE(P_TABLE_NAME);
07:38:28 913  
07:38:28 914  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 915  												       C_STATUS_DONE);
07:38:28 916  		      ELSE
07:38:28 917  			      NULL;
07:38:28 918  
07:38:28 919  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 920  												       C_STATUS_redundent);
07:38:28 921  		      END IF;
07:38:28 922  
07:38:28 923  	      EXCEPTION
07:38:28 924  		      WHEN OTHERS THEN
07:38:28 925  			      UPDATE_STEP_STATUS(P_STEP_ID,
07:38:28 926  												       C_STATUS_ERROR,
07:38:28 927  												       SQLERRM);
07:38:28 928  		      RAISE;
07:38:28 929  
07:38:28 930  	      END SAFE_DROP_TABLE;
07:38:28 931  
07:38:28 932  	      /*
07:38:28 933  	--------------------------------------------------------------------------------------------------------------------------------------
07:38:28 934  
07:38:28 935  	  package public methods start here
07:38:28 936  
07:38:28 937  	--------------------------------------------------------------------------------------------------------------------------------------
07:38:28 938  	*/
07:38:28 939  
07:38:28 940  	      /*
07:38:28 941  
07:38:28 942  	     execute procedures ( not in use yet )
07:38:28 943  
07:38:28 944  	*/
07:38:28 945  
07:38:28 946  	      PROCEDURE EXECUTE_ALL IS
07:38:28 947  	      BEGIN
07:38:28 948  		      NULL;
07:38:28 949  	      END EXECUTE_ALL;
07:38:28 950  	      PROCEDURE EXECUTE_TABLE(P_TABLE_NAME VARCHAR2) IS
07:38:28 951  	      BEGIN
07:38:28 952  		      NULL;
07:38:28 953  	      END EXECUTE_TABLE;
07:38:28 954  
07:38:28 955  	      /*
07:38:28 956  
07:38:28 957  	     action procedures
07:38:28 958  
07:38:28 959  	*/
07:38:28 960  
07:38:28 961  	      PROCEDURE ADD_COLUMN(P_TABLE_NAME VARCHAR2, P_COLUMN_NAME VARCHAR2, P_COLUMN_TYPE VARCHAR2,
07:38:28 962  											       P_NULLABLE VARCHAR2, P_DEFAULT VARCHAR2) IS
07:38:28 963  		      L_TABLE_NAME  VARCHAR2(30) := SANITIZE(P_TABLE_NAME);
07:38:28 964  		      L_COLUMN_NAME VARCHAR2(30) := SANITIZE(P_COLUMN_NAME);
07:38:28 965  		      L_COLUMN_TYPE VARCHAR2(30) := SANITIZE(P_COLUMN_TYPE);
07:38:28 966  		      L_NULLABLE    VARCHAR2(30) := SANITIZE(P_NULLABLE);
07:38:28 967  		      L_DEFAULT     VARCHAR2(1000) := SANITIZE(P_DEFAULT);
07:38:28 968  		      L_STEP_ID     NUMBER;
07:38:28 969  	      BEGIN
07:38:28 970  		      INSERT INTO UPGRADE_STEPS
07:38:28 971  			      (ID,
07:38:28 972  			       ACTION,
07:38:28 973  			       OBJECT_TYPE,
07:38:28 974  			       OBJECT_NAME,
07:38:28 975  			       ALTER_ACTION,
07:38:28 976  			       ALTER_OBJECT_TYPE,
07:38:28 977  			       COLUMN_NAME,
07:38:28 978  			       COLUMN_TYPE,
07:38:28 979  			       COLUMN_DEFAULT,
07:38:28 980  			       COLUMN_NULLABLE)
07:38:28 981  		      VALUES
07:38:28 982  			      (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 983  			       C_ACTION_ALTER,
07:38:28 984  			       C_OBJECT_TYPE_TABLE,
07:38:28 985  			       L_TABLE_NAME,
07:38:28 986  			       C_ALTER_ACTION_ADD,
07:38:28 987  			       C_ALTER_OBJECT_TYPE_COLUMN,
07:38:28 988  			       L_COLUMN_NAME,
07:38:28 989  			       L_COLUMN_TYPE,
07:38:28 990  			       L_DEFAULT,
07:38:28 991  			       L_NULLABLE)
07:38:28 992  		      RETURNING ID INTO L_STEP_ID;
07:38:28 993  		      COMMIT;
07:38:28 994  		      SAFE_ADD_COLUMN(L_STEP_ID,
07:38:28 995  										      L_TABLE_NAME,
07:38:28 996  										      L_COLUMN_NAME,
07:38:28 997  										      L_COLUMN_TYPE,
07:38:28 998  										      L_NULLABLE,
07:38:28 999  										      L_DEFAULT);
07:38:28 1000  
07:38:28 1001  	       END;
07:38:28 1002  
07:38:28 1003  	       PROCEDURE DROP_COLUMN(P_TABLE_NAME VARCHAR2, P_COLUMN_NAME VARCHAR2) IS
07:38:28 1004  		       L_TABLE_NAME  VARCHAR2(30) := SANITIZE(P_TABLE_NAME);
07:38:28 1005  		       L_COLUMN_NAME VARCHAR2(30) := SANITIZE(P_COLUMN_NAME);
07:38:28 1006  		       L_STEP_ID     NUMBER;
07:38:28 1007  	       BEGIN
07:38:28 1008  
07:38:28 1009  		       INSERT INTO UPGRADE_STEPS
07:38:28 1010  			       (ID,
07:38:28 1011  				ACTION,
07:38:28 1012  				OBJECT_TYPE,
07:38:28 1013  				OBJECT_NAME,
07:38:28 1014  				ALTER_ACTION,
07:38:28 1015  				ALTER_OBJECT_TYPE,
07:38:28 1016  				COLUMN_NAME)
07:38:28 1017  		       VALUES
07:38:28 1018  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1019  				C_ACTION_ALTER,
07:38:28 1020  				C_OBJECT_TYPE_TABLE,
07:38:28 1021  				P_TABLE_NAME,
07:38:28 1022  				C_ALTER_ACTION_DROP,
07:38:28 1023  				C_ALTER_OBJECT_TYPE_COLUMN,
07:38:28 1024  				L_COLUMN_NAME)
07:38:28 1025  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1026  		       COMMIT;
07:38:28 1027  
07:38:28 1028  		       SAFE_DROP_COLUMN(L_STEP_ID,
07:38:28 1029  											L_TABLE_NAME,
07:38:28 1030  											L_COLUMN_NAME);
07:38:28 1031  
07:38:28 1032  	       END;
07:38:28 1033  
07:38:28 1034  	       PROCEDURE MODIFY_COLUMN(P_TABLE_NAME VARCHAR2, P_COLUMN_NAME VARCHAR2, P_COLUMN_TYPE VARCHAR2,
07:38:28 1035  													       P_NULLABLE VARCHAR2, P_DEFAULT VARCHAR2) IS
07:38:28 1036  		       L_TABLE_NAME  VARCHAR2(30) := SANITIZE(P_TABLE_NAME);
07:38:28 1037  		       L_COLUMN_NAME VARCHAR2(30) := SANITIZE(P_COLUMN_NAME);
07:38:28 1038  		       L_COLUMN_TYPE VARCHAR2(30) := SANITIZE(P_COLUMN_TYPE);
07:38:28 1039  		       L_NULLABLE    VARCHAR2(30) := SANITIZE(P_NULLABLE);
07:38:28 1040  		       L_DEFAULT     VARCHAR2(1000) := SANITIZE(P_DEFAULT);
07:38:28 1041  		       L_STEP_ID     NUMBER;
07:38:28 1042  	       BEGIN
07:38:28 1043  
07:38:28 1044  		       -- safe_add_column modifies column if it already exists
07:38:28 1045  		       INSERT INTO UPGRADE_STEPS
07:38:28 1046  			       (ID,
07:38:28 1047  				ACTION,
07:38:28 1048  				OBJECT_TYPE,
07:38:28 1049  				OBJECT_NAME,
07:38:28 1050  				ALTER_ACTION,
07:38:28 1051  				ALTER_OBJECT_TYPE,
07:38:28 1052  				COLUMN_NAME,
07:38:28 1053  				COLUMN_TYPE,
07:38:28 1054  				COLUMN_DEFAULT,
07:38:28 1055  				COLUMN_NULLABLE)
07:38:28 1056  		       VALUES
07:38:28 1057  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1058  				C_ACTION_ALTER,
07:38:28 1059  				C_OBJECT_TYPE_TABLE,
07:38:28 1060  				P_TABLE_NAME,
07:38:28 1061  				C_ALTER_ACTION_MODIFY,
07:38:28 1062  				C_ALTER_OBJECT_TYPE_COLUMN,
07:38:28 1063  				L_COLUMN_NAME,
07:38:28 1064  				L_COLUMN_TYPE,
07:38:28 1065  				L_DEFAULT,
07:38:28 1066  				L_NULLABLE)
07:38:28 1067  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1068  		       COMMIT;
07:38:28 1069  
07:38:28 1070  		       ADD_COLUMN(L_TABLE_NAME,
07:38:28 1071  								L_COLUMN_NAME,
07:38:28 1072  								L_COLUMN_TYPE,
07:38:28 1073  								L_NULLABLE,
07:38:28 1074  								L_DEFAULT);
07:38:28 1075  
07:38:28 1076  	       END;
07:38:28 1077  
07:38:28 1078  	       -- Refactored procedure exists_index_with_name
07:38:28 1079  
07:38:28 1080  	       PROCEDURE CREATE_INDEX(P_TABLE_NAME VARCHAR2, P_INDEX_NAME VARCHAR2, P_COLUMNS VARCHAR2,
07:38:28 1081  													P_UNIQUE NUMBER) IS
07:38:28 1082  
07:38:28 1083  		       L_TABLE_NAME VARCHAR2(30) := SANITIZE(P_TABLE_NAME);
07:38:28 1084  		       L_INDEX_NAME VARCHAR2(30) := SANITIZE(P_INDEX_NAME);
07:38:28 1085  		       L_COLUMNS    VARCHAR2(32767) := SANITIZE(P_COLUMNS);
07:38:28 1086  		       L_UNIQUE     VARCHAR2(30) := SANITIZE(P_UNIQUE);
07:38:28 1087  		       L_STEP_ID    NUMBER;
07:38:28 1088  	       BEGIN
07:38:28 1089  
07:38:28 1090  		       -- safe_add_column modifies column if it already exists
07:38:28 1091  		       INSERT INTO UPGRADE_STEPS
07:38:28 1092  			       (ID,
07:38:28 1093  				ACTION,
07:38:28 1094  				OBJECT_TYPE,
07:38:28 1095  				OBJECT_NAME,
07:38:28 1096  				TABLE_COLUMNS,
07:38:28 1097  				INDEX_UNIQUE)
07:38:28 1098  		       VALUES
07:38:28 1099  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1100  				C_ACTION_CREATE,
07:38:28 1101  				C_OBJECT_TYPE_INDEX,
07:38:28 1102  				P_INDEX_NAME,
07:38:28 1103  				P_COLUMNS,
07:38:28 1104  				P_UNIQUE)
07:38:28 1105  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1106  		       COMMIT;
07:38:28 1107  
07:38:28 1108  		       SAFE_CREATE_INDEX(L_STEP_ID,
07:38:28 1109  											       L_TABLE_NAME,
07:38:28 1110  											       L_INDEX_NAME,
07:38:28 1111  											       L_COLUMNS,
07:38:28 1112  											       L_UNIQUE);
07:38:28 1113  
07:38:28 1114  	       END CREATE_INDEX;
07:38:28 1115  
07:38:28 1116  	       PROCEDURE DROP_INDEX(P_INDEX_NAME VARCHAR2) IS
07:38:28 1117  		       L_INDEX_NAME VARCHAR2(30) := SANITIZE(P_INDEX_NAME);
07:38:28 1118  		       L_STEP_ID    NUMBER;
07:38:28 1119  	       BEGIN
07:38:28 1120  
07:38:28 1121  		       -- safe_add_column modifies column if it already exists
07:38:28 1122  		       INSERT INTO UPGRADE_STEPS
07:38:28 1123  			       (ID,
07:38:28 1124  				ACTION,
07:38:28 1125  				OBJECT_TYPE,
07:38:28 1126  				OBJECT_NAME)
07:38:28 1127  		       VALUES
07:38:28 1128  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1129  				C_ACTION_DROP,
07:38:28 1130  				C_OBJECT_TYPE_INDEX,
07:38:28 1131  				L_INDEX_NAME)
07:38:28 1132  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1133  		       COMMIT;
07:38:28 1134  
07:38:28 1135  		       SAFE_DROP_INDEX(L_STEP_ID,
07:38:28 1136  										       L_INDEX_NAME);
07:38:28 1137  
07:38:28 1138  	       END DROP_INDEX;
07:38:28 1139  
07:38:28 1140  	       PROCEDURE DROP_CONSTRAINT(P_TABLE_NAME VARCHAR2, P_CONSTRAINT_NAME VARCHAR2) IS
07:38:28 1141  		       L_TABLE_NAME	 VARCHAR2(30) := SANITIZE(P_TABLE_NAME);
07:38:28 1142  		       L_CONSTRAINT_NAME VARCHAR2(30) := SANITIZE(P_CONSTRAINT_NAME);
07:38:28 1143  		       L_STEP_ID	 NUMBER;
07:38:28 1144  	       BEGIN
07:38:28 1145  
07:38:28 1146  		       INSERT INTO UPGRADE_STEPS
07:38:28 1147  			       (ID,
07:38:28 1148  				ACTION,
07:38:28 1149  				OBJECT_TYPE,
07:38:28 1150  				OBJECT_NAME,
07:38:28 1151  				ALTER_ACTION,
07:38:28 1152  				ALTER_OBJECT_TYPE,
07:38:28 1153  				ALTER_OBJECT_NAME)
07:38:28 1154  		       VALUES
07:38:28 1155  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1156  				C_ACTION_ALTER,
07:38:28 1157  				C_OBJECT_TYPE_TABLE,
07:38:28 1158  				L_TABLE_NAME,
07:38:28 1159  				C_ALTER_ACTION_DROP,
07:38:28 1160  				C_ALTER_OBJECT_TYPE_CONSTRAINT,
07:38:28 1161  				L_CONSTRAINT_NAME)
07:38:28 1162  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1163  		       COMMIT;
07:38:28 1164  		       SAFE_DROP_CONSTRAINT(L_STEP_ID,
07:38:28 1165  													L_TABLE_NAME,
07:38:28 1166  													L_CONSTRAINT_NAME);
07:38:28 1167  
07:38:28 1168  	       END DROP_CONSTRAINT;
07:38:28 1169  	       PROCEDURE DROP_PKG(P_PKG_NAME VARCHAR2) IS
07:38:28 1170  
07:38:28 1171  		       L_PKG_NAME VARCHAR2(30) := SANITIZE(P_PKG_NAME);
07:38:28 1172  		       L_STEP_ID  NUMBER;
07:38:28 1173  	       BEGIN
07:38:28 1174  
07:38:28 1175  		       -- safe_add_column modifies column if it already exists
07:38:28 1176  		       INSERT INTO UPGRADE_STEPS
07:38:28 1177  			       (ID,
07:38:28 1178  				ACTION,
07:38:28 1179  				OBJECT_TYPE,
07:38:28 1180  				OBJECT_NAME)
07:38:28 1181  		       VALUES
07:38:28 1182  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1183  				C_ACTION_DROP,
07:38:28 1184  				C_OBJECT_TYPE_PACKAGE,
07:38:28 1185  				L_PKG_NAME)
07:38:28 1186  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1187  		       COMMIT;
07:38:28 1188  		       SAFE_DROP_PKG(L_STEP_ID,
07:38:28 1189  									       L_PKG_NAME);
07:38:28 1190  
07:38:28 1191  	       END DROP_PKG;
07:38:28 1192  	       PROCEDURE DROP_PROCEDURE(P_PROCEDURE_NAME VARCHAR2) IS
07:38:28 1193  
07:38:28 1194  		       L_PROCEDURE_NAME VARCHAR2(30) := SANITIZE(P_PROCEDURE_NAME);
07:38:28 1195  		       L_STEP_ID	NUMBER;
07:38:28 1196  	       BEGIN
07:38:28 1197  
07:38:28 1198  		       -- safe_add_column modifies column if it already exists
07:38:28 1199  		       INSERT INTO UPGRADE_STEPS
07:38:28 1200  			       (ID,
07:38:28 1201  				ACTION,
07:38:28 1202  				OBJECT_TYPE,
07:38:28 1203  				OBJECT_NAME)
07:38:28 1204  		       VALUES
07:38:28 1205  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1206  				C_ACTION_DROP,
07:38:28 1207  				C_OBJECT_TYPE_PROCEDURE,
07:38:28 1208  				L_PROCEDURE_NAME)
07:38:28 1209  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1210  		       COMMIT;
07:38:28 1211  		       SAFE_DROP_PROCEDURE(L_STEP_ID,
07:38:28 1212  												       L_PROCEDURE_NAME);
07:38:28 1213  
07:38:28 1214  	       END DROP_PROCEDURE;
07:38:28 1215  	       PROCEDURE DROP_FUNCTION(P_FUNCTION_NAME VARCHAR2) IS
07:38:28 1216  
07:38:28 1217  		       L_FUNCTION_NAME VARCHAR2(30) := SANITIZE(P_FUNCTION_NAME);
07:38:28 1218  		       L_STEP_ID       NUMBER;
07:38:28 1219  	       BEGIN
07:38:28 1220  
07:38:28 1221  		       -- safe_add_column modifies column if it already exists
07:38:28 1222  		       INSERT INTO UPGRADE_STEPS
07:38:28 1223  			       (ID,
07:38:28 1224  				ACTION,
07:38:28 1225  				OBJECT_TYPE,
07:38:28 1226  				OBJECT_NAME)
07:38:28 1227  		       VALUES
07:38:28 1228  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1229  				C_ACTION_DROP,
07:38:28 1230  				C_OBJECT_TYPE_FUNCTION,
07:38:28 1231  				L_FUNCTION_NAME)
07:38:28 1232  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1233  		       COMMIT;
07:38:28 1234  		       SAFE_DROP_FUNCTION(L_STEP_ID,
07:38:28 1235  												L_FUNCTION_NAME);
07:38:28 1236  
07:38:28 1237  	       END DROP_FUNCTION;
07:38:28 1238  
07:38:28 1239  	       PROCEDURE DROP_SEQUENCE(P_SEQUENCE_NAME VARCHAR2) IS
07:38:28 1240  
07:38:28 1241  		       L_SEQUENCE_NAME VARCHAR2(30) := SANITIZE(P_SEQUENCE_NAME);
07:38:28 1242  		       L_STEP_ID       NUMBER;
07:38:28 1243  	       BEGIN
07:38:28 1244  
07:38:28 1245  		       -- safe_add_column modifies column if it already exists
07:38:28 1246  		       INSERT INTO UPGRADE_STEPS
07:38:28 1247  			       (ID,
07:38:28 1248  				ACTION,
07:38:28 1249  				OBJECT_TYPE,
07:38:28 1250  				OBJECT_NAME)
07:38:28 1251  		       VALUES
07:38:28 1252  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1253  				C_ACTION_DROP,
07:38:28 1254  				C_OBJECT_TYPE_SEQUENCE,
07:38:28 1255  				L_SEQUENCE_NAME)
07:38:28 1256  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1257  		       COMMIT;
07:38:28 1258  		       SAFE_DROP_SEQUENCE(L_STEP_ID,
07:38:28 1259  												L_SEQUENCE_NAME);
07:38:28 1260  
07:38:28 1261  	       END DROP_SEQUENCE;
07:38:28 1262  	       PROCEDURE DROP_VIEW(P_VIEW_NAME VARCHAR2) IS
07:38:28 1263  
07:38:28 1264  		       L_VIEW_NAME VARCHAR2(30) := SANITIZE(P_VIEW_NAME);
07:38:28 1265  		       L_STEP_ID   NUMBER;
07:38:28 1266  	       BEGIN
07:38:28 1267  
07:38:28 1268  		       -- safe_add_column modifies column if it already exists
07:38:28 1269  		       INSERT INTO UPGRADE_STEPS
07:38:28 1270  			       (ID,
07:38:28 1271  				ACTION,
07:38:28 1272  				OBJECT_TYPE,
07:38:28 1273  				OBJECT_NAME)
07:38:28 1274  		       VALUES
07:38:28 1275  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1276  				C_ACTION_DROP,
07:38:28 1277  				C_OBJECT_TYPE_VIEW,
07:38:28 1278  				L_VIEW_NAME)
07:38:28 1279  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1280  		       COMMIT;
07:38:28 1281  		       SAFE_DROP_VIEW(L_STEP_ID,
07:38:28 1282  										L_VIEW_NAME);
07:38:28 1283  
07:38:28 1284  	       END DROP_VIEW;
07:38:28 1285  	       PROCEDURE DROP_MVIEW(P_MVIEW_NAME VARCHAR2) IS
07:38:28 1286  
07:38:28 1287  		       L_MVIEW_NAME VARCHAR2(30) := SANITIZE(P_MVIEW_NAME);
07:38:28 1288  		       L_STEP_ID    NUMBER;
07:38:28 1289  	       BEGIN
07:38:28 1290  
07:38:28 1291  		       -- safe_add_column modifies column if it already exists
07:38:28 1292  		       INSERT INTO UPGRADE_STEPS
07:38:28 1293  			       (ID,
07:38:28 1294  				ACTION,
07:38:28 1295  				OBJECT_TYPE,
07:38:28 1296  				OBJECT_NAME)
07:38:28 1297  		       VALUES
07:38:28 1298  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1299  				C_ACTION_DROP,
07:38:28 1300  				C_OBJECT_TYPE_MVIEW,
07:38:28 1301  				L_MVIEW_NAME)
07:38:28 1302  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1303  		       COMMIT;
07:38:28 1304  		       SAFE_DROP_MVIEW(L_STEP_ID,
07:38:28 1305  										       L_MVIEW_NAME);
07:38:28 1306  
07:38:28 1307  	       END DROP_MVIEW;
07:38:28 1308  	       PROCEDURE DROP_TABLE(P_TABLE_NAME VARCHAR2) IS
07:38:28 1309  		       L_TABLE_NAME VARCHAR2(30) := SANITIZE(P_TABLE_NAME);
07:38:28 1310  
07:38:28 1311  		       L_STEP_ID NUMBER;
07:38:28 1312  	       BEGIN
07:38:28 1313  
07:38:28 1314  		       -- safe_add_column modifies column if it already exists
07:38:28 1315  		       INSERT INTO UPGRADE_STEPS
07:38:28 1316  			       (ID,
07:38:28 1317  				ACTION,
07:38:28 1318  				OBJECT_TYPE,
07:38:28 1319  				OBJECT_NAME)
07:38:28 1320  		       VALUES
07:38:28 1321  			       (SEQ_UPGRADE_STEPS.NEXTVAL,
07:38:28 1322  				C_ACTION_DROP,
07:38:28 1323  				C_OBJECT_TYPE_TABLE,
07:38:28 1324  				L_TABLE_NAME)
07:38:28 1325  		       RETURNING ID INTO L_STEP_ID;
07:38:28 1326  		       COMMIT;
07:38:28 1327  		       SAFE_DROP_TABLE(L_STEP_ID, L_TABLE_NAME);
07:38:28 1328  
07:38:28 1329  	       END DROP_TABLE;
07:38:28 1330  
07:38:28 1331  	 PROCEDURE DROP_OBJECT(P_OBJECT_TYPE VARCHAR2,
07:38:28 1332  			       P_OBJECT_NAME VARCHAR2) as
07:38:28 1333  	 begin
07:38:28 1334  	   null;
07:38:28 1335  	 end;
07:38:28 1336  
07:38:28 1337  BEGIN
07:38:28 1338  	       NULL;
07:38:28 1339  END;
07:38:28 1340  /

Package body created.

Elapsed: 00:00:00.42
07:38:29 SQL> 
07:38:29 SQL> CREATE OR REPLACE FORCE VIEW V_UPGRADE_STEPS AS
07:38:29   2  SELECT	ID,
07:38:29   3  		      STATUS_H,
07:38:29   4  		      error_message,
07:38:29   5  		      ACTION_H,
07:38:29   6  		      OBJECT_TYPE_H,
07:38:29   7  		      OBJECT_NAME,
07:38:29   8  		      ALTER_ACTION_H,
07:38:29   9  		      ALTER_OBJECT_TYPE_H,
07:38:29  10  		      ALTER_OBJECT_NAME,
07:38:29  11  		      CONSTRAINT_TYPE_H,
07:38:29  12  		      table_columns,
07:38:29  13  		      parent_table,
07:38:29  14  		      parent_table_columns,
07:38:29  15  		      column_name,
07:38:29  16  		      column_type,
07:38:29  17  		      column_nullable,
07:38:29  18  		      column_default
07:38:29  19  FROM   UPGRADE_STEPS;

View created.

Elapsed: 00:00:00.02
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/EBS_SCHEMA_UTIL.util  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/EBS_SCHEMA_UTIL.util  ****/
07:38:29 SQL> /**********************************************
07:38:29 SQL> THIS PACKAGE REQUIRES ****EBS_UPLOAD_UTILS ****
07:38:29 SQL> ***********************************************/
07:38:29 SQL> 
07:38:29 SQL> create sequence seq_ebs_schema_util_log start with 10000000 increment by 1 ;

Sequence created.

Elapsed: 00:00:00.01
07:38:29 SQL> create table log_ebs_schema_util (
07:38:29   2  	     id 	     number (30),
07:38:29   3  	     logging_method  varchar2(1000),
07:38:29   4  	     LOG_MSG	     VARCHAR2(4000),
07:38:29   5  	     log_type	     varchar2(50),
07:38:29   6  	     log_time	     timestamp default systimestamp,
07:38:29   7  	     object_type     varchar2(1000),
07:38:29   8  	     OBJECT_NAME     varchar2(1000)
07:38:29   9  );

Table created.

Elapsed: 00:00:00.01
07:38:29 SQL> 
07:38:29 SQL> CREATE UNIQUE INDEX pk_log_ebs_schema_util ON log_ebs_schema_util(ID);

Index created.

Elapsed: 00:00:00.01
07:38:29 SQL> ALTER TABLE log_ebs_schema_util ADD CONSTRAINT pk_log_ebs_schema_util PRIMARY KEY (ID);

Table altered.

Elapsed: 00:00:00.01
07:38:29 SQL> 
07:38:29 SQL> CREATE OR REPLACE PACKAGE EBS_SCHEMA_UTIL AS
07:38:29   2  	     MSG_INFO	 constant log_ebs_schema_util.log_type%type := 'Info';
07:38:29   3  	     MSG_WARNING constant log_ebs_schema_util.log_type%type := 'Warning';
07:38:29   4  	     MSG_ERROR	 constant log_ebs_schema_util.log_type%type := 'Error';
07:38:29   5  	     MSG_START	 constant log_ebs_schema_util.log_type%type := 'Start';
07:38:29   6  	     MSG_END	 constant log_ebs_schema_util.log_type%type := 'End';
07:38:29   7  
07:38:29   8  /* ----------------------------------------------------------- */
07:38:29   9  PROCEDURE Logger(log_msg	     in varchar2,
07:38:29  10  		       log_type      in varchar2,
07:38:29  11  		       object_type   in varchar2,
07:38:29  12  		       OBJECT_NAME   in varchar2,
07:38:29  13  		       logging_method in varchar2)  ;
07:38:29  14  /* ----------------------------------------------------------- */
07:38:29  15  procedure change_fk_status(p_new_status in varchar2,
07:38:29  16  				 p_FK_pattern in varchar2 DEFAULT '%',
07:38:29  17  				 p_table_pattern in varchar2 DEFAULT '%',
07:38:29  18  				 p_ignore_prefix in varchar2 default 'VFK');
07:38:29  19  /* ----------------------------------------------------------- */
07:38:29  20  procedure check_Objects_naming;
07:38:29  21  /* ----------------------------------------------------------- */
07:38:29  22  procedure log_uplaod(P_APPLICATION VARCHAR2,
07:38:29  23  			      P_MAJOR	  NUMBER,
07:38:29  24  			      P_MINOR	  NUMBER,
07:38:29  25  			      P_PATCH	  NUMBER,
07:38:29  26  			      P_BUILD		  NUMBER,
07:38:29  27  			      P_STATUS		  VARCHAR2,
07:38:29  28  			      P_COMMENT 	  VARCHAR2);
07:38:29  29  /* ----------------------------------------------------------- */
07:38:29  30  END EBS_SCHEMA_UTIL;
07:38:29  31  /

Package created.

Elapsed: 00:00:00.02
07:38:29 SQL> CREATE OR REPLACE PACKAGE BODY EBS_SCHEMA_UTIL	AS
07:38:29   2  
07:38:29   3  /* ----------------------------------------------------------- */
07:38:29   4  PROCEDURE Logger(log_msg	     in varchar2,
07:38:29   5  		       log_type      in varchar2,
07:38:29   6  		       object_type   in varchar2,
07:38:29   7  		       OBJECT_NAME   in varchar2,
07:38:29   8  		       logging_method in varchar2) as
07:38:29   9  	PRAGMA AUTONOMOUS_TRANSACTION;
07:38:29  10  begin
07:38:29  11  	insert into log_ebs_schema_util(id, log_time, log_msg, log_type, object_type, object_name,logging_method)
07:38:29  12  	   values (seq_ebs_schema_util_log.nextval, systimestamp, log_msg,log_type,  object_type, OBJECT_NAME, logging_method );
07:38:29  13  	commit;
07:38:29  14  end Logger;
07:38:29  15  
07:38:29  16  /* ----------------------------------------------------------- */
07:38:29  17  procedure change_fk_status(p_new_status in varchar2,
07:38:29  18  				 p_FK_pattern in varchar2 DEFAULT '%',
07:38:29  19  				 p_table_pattern in varchar2 DEFAULT '%',
07:38:29  20  				 p_ignore_prefix in varchar2 default 'VFK') as
07:38:29  21  	lIgnoredFK number := 0;
07:38:29  22  	lChangedFK number := 0;
07:38:29  23  	lFailedFK  number := 0;
07:38:29  24  	lAlterFK varchar2(1000);
07:38:29  25  	lNewStatus varchar2(10);
07:38:29  26  begin
07:38:29  27  	--validate status parameter
07:38:29  28  	if    (upper(trim(p_new_status))='ENABLE')  then  lNewStatus := 'ENABLED';
07:38:29  29  	elsif (upper(trim(p_new_status))='DISABLE') then  lNewStatus := 'DISABLED';
07:38:29  30  	ELSE  raise_application_error(-20100,'FK status should be ENABLE/DISABLE');
07:38:29  31  	end if;
07:38:29  32  
07:38:29  33  	-- Loop over ptential FKs to alter
07:38:29  34  	for fkList in (
07:38:29  35  	  select upper(TABLE_NAME) TABLE_NAME ,upper(CONSTRAINT_NAME) CONSTRAINT_NAME
07:38:29  36  	  from user_constraints
07:38:29  37  	  where CONSTRAINT_TYPE='R'
07:38:29  38  	    and upper(status)<>lNewStatus
07:38:29  39  	    AND upper(constraint_name) like upper(p_FK_pattern)
07:38:29  40  	    AND upper(TABLE_NAME) like upper(p_table_pattern)
07:38:29  41  	  order by table_name, constraint_name
07:38:29  42  	) loop
07:38:29  43  	  if(instr(fkList.constraint_name, upper(p_ignore_prefix))=1 ) then
07:38:29  44  	    lIgnoredFK := lIgnoredFK + 1 ;
07:38:29  45  	  else -- alter FK status & handle exceptions
07:38:29  46  	    begin
07:38:29  47  	      lAlterFK := 'ALTER TABLE ' || fkList.table_name ||' ' || p_new_status || ' CONSTRAINT ' || fkList.constraint_Name ;
07:38:29  48  	      execute immediate lAlterFK;
07:38:29  49  	      lChangedFK := lChangedFK + 1;
07:38:29  50  	    exception
07:38:29  51  	      when others then
07:38:29  52  		Logger(log_msg	     => p_new_status || ' failed: ' ||SQLERRM,
07:38:29  53  		       log_type      => MSG_ERROR,
07:38:29  54  		       object_type   => 'FK',
07:38:29  55  		       OBJECT_NAME   => fkList.table_name || '.' || fkList.constraint_Name,
07:38:29  56  		       logging_method => 'EBS_SCHEMA_UTIL.CHANGE_FK_STATUS'  );
07:38:29  57  		lFailedFK := lFailedFK + 1;
07:38:29  58  	    end;
07:38:29  59  	  end if;
07:38:29  60  	end loop fkList;
07:38:29  61  
07:38:29  62  	Logger(log_msg	     => p_new_status || ' FKS: ' || lChangedFK || ' FK cahnged, ' || lFailedFK || ' failed to change and ' || lIgnoredFK ||' ignored',
07:38:29  63  	     log_type	   => MSG_INFO,
07:38:29  64  	     object_type   => null,
07:38:29  65  	     OBJECT_NAME   => null,
07:38:29  66  	     logging_method => 'EBS_SCHEMA_UTIL.CHANGE_FK_STATUS'  );
07:38:29  67  end;
07:38:29  68  
07:38:29  69  /* ----------------------------------------------------------- */
07:38:29  70  procedure compile_schema
07:38:29  71  is
07:38:29  72  begin
07:38:29  73  	null;
07:38:29  74  end compile_schema;
07:38:29  75  
07:38:29  76  /* ----------------------------------------------------------- */
07:38:29  77  function tables_name_validated (p_max_length in number default 24,
07:38:29  78  				      p_calling_method IN VARCHAR2) return boolean is
07:38:29  79   lNamingOK boolean := true;
07:38:29  80   l_calling_method varchar2(200);
07:38:29  81  begin
07:38:29  82  	l_calling_method := nvl(p_calling_method,'EBS_SCHEMA_UTIL.tables_name_validated');
07:38:29  83  	for i in (
07:38:29  84  	  select table_name, length(table_name) AS name_length
07:38:29  85  	  from user_tables
07:38:29  86  	  where length(table_name) >p_max_length
07:38:29  87  	  minus
07:38:29  88  	  select MVIEW_NAME, length(MVIEW_NAME) AS name_length
07:38:29  89  	  from user_mviews
07:38:29  90  	) loop
07:38:29  91  	    lNamingOK := false;
07:38:29  92  	    Logger(log_msg	 => 'Name is '|| i.name_length ||' chars. Limit is '|| p_max_length,
07:38:29  93  		   log_type	 => MSG_INFO,
07:38:29  94  		   object_type	 => 'TABLE/MV',
07:38:29  95  		   OBJECT_NAME	 => i.table_name,
07:38:29  96  		   logging_method=> l_calling_method  );
07:38:29  97  	end loop;
07:38:29  98  
07:38:29  99  	return lNamingOK ;
07:38:29 100  end;
07:38:29 101  
07:38:29 102  /* ----------------------------------------------------------- */
07:38:29 103  function mviews_name_validated (p_max_length in number	 default 24,
07:38:29 104  				      p_prefix	   in varchar2 default 'MV/_',
07:38:29 105  				      p_calling_method in varchar2 ) return boolean is
07:38:29 106   lNamingOK boolean := true;
07:38:29 107   lErrMsg varchar2(1000);
07:38:29 108   l_calling_method varchar2(200);
07:38:29 109  begin
07:38:29 110  	l_calling_method := nvl(p_calling_method,'EBS_SCHEMA_UTIL.mviews_name_validated');
07:38:29 111  	for i in (
07:38:29 112  	  select upper(MVIEW_NAME) as table_name, length(MVIEW_NAME) AS name_length
07:38:29 113  	  from user_mviews
07:38:29 114  	  where length(MVIEW_NAME) > p_max_length
07:38:29 115  	     or upper(MVIEW_NAME) not like upper(p_prefix||'%') escape '/'
07:38:29 116  	) loop
07:38:29 117  	    lNamingOK := false;
07:38:29 118  	    if (i.name_length > p_max_length ) then
07:38:29 119  	      lErrMsg := 'Name is '|| i.name_length ||' chars. Limit is '|| p_max_length;
07:38:29 120  	    end if;
07:38:29 121  
07:38:29 122  	    if (i.table_name not like upper(p_prefix||'%') escape '/' ) then
07:38:29 123  	      lErrMsg := lErrMsg || ' Name prefix is not '||p_prefix;
07:38:29 124  	    end if;
07:38:29 125  
07:38:29 126  	    Logger(log_msg	 => lErrMsg,
07:38:29 127  		   log_type	 => MSG_INFO,
07:38:29 128  		   object_type	 => 'MVIEW',
07:38:29 129  		   OBJECT_NAME	 => i.table_name,
07:38:29 130  		   logging_method=> l_calling_method  );
07:38:29 131  	end loop;
07:38:29 132  
07:38:29 133  	return lNamingOK ;
07:38:29 134  end;
07:38:29 135  /* ----------------------------------------------------------- */
07:38:29 136  
07:38:29 137  function views_name_validated (p_prefix in varchar2 default 'V/_',
07:38:29 138  				     p_calling_method in varchar2 )  return boolean is
07:38:29 139   lNamingOK boolean := true;
07:38:29 140   l_calling_method varchar2(200);
07:38:29 141  begin
07:38:29 142  	l_calling_method := nvl(p_calling_method,'EBS_SCHEMA_UTIL.views_name_validated');
07:38:29 143  	for i in (
07:38:29 144  	  select view_name
07:38:29 145  	  from user_views
07:38:29 146  	  where upper(view_name) not like upper(p_prefix||'%') escape '/'
07:38:29 147  	) loop
07:38:29 148  	    lNamingOK := false;
07:38:29 149  	    Logger(log_msg	 => i.view_name || 'does not start with '||p_prefix,
07:38:29 150  		   log_type	 => MSG_INFO,
07:38:29 151  		   object_type	 => 'VIEW',
07:38:29 152  		   OBJECT_NAME	 => i.view_name,
07:38:29 153  		   logging_method=> l_calling_method  );
07:38:29 154  	end loop;
07:38:29 155  
07:38:29 156  	return lNamingOK ;
07:38:29 157  end;
07:38:29 158  /* ----------------------------------------------------------- */
07:38:29 159  
07:38:29 160  function indecies_name_validated (p_calling_method in varchar2)return boolean is
07:38:29 161   lNamingOK boolean := true;
07:38:29 162   l_calling_method varchar2(200);
07:38:29 163  begin
07:38:29 164  	l_calling_method := nvl(p_calling_method,'EBS_SCHEMA_UTIL.indecies_name_validated');
07:38:29 165  	for i in (
07:38:29 166  	  select index_name, table_name
07:38:29 167  	  from user_indexes
07:38:29 168  	  where substr(index_name,1,length(table_name)+4) <> table_name||'_IDX'
07:38:29 169  	    and index_name<>'PK_'||table_name
07:38:29 170  	    and INDEX_TYPE NOT LIKE '%LOB%'
07:38:29 171  	  order by table_name, index_name
07:38:29 172  	) loop
07:38:29 173  	    lNamingOK := false;
07:38:29 174  	    Logger(log_msg	 => i.index_name || 'on table '||i.table_name ||' does not comply with standards.',
07:38:29 175  		   log_type	 => MSG_INFO,
07:38:29 176  		   object_type	 => 'INDEX',
07:38:29 177  		   OBJECT_NAME	 => i.index_name,
07:38:29 178  		   logging_method=> l_calling_method  );
07:38:29 179  	end loop;
07:38:29 180  
07:38:29 181  	return lNamingOK ;
07:38:29 182  end;
07:38:29 183  
07:38:29 184  /* ----------------------------------------------------------- */
07:38:29 185  
07:38:29 186  function sequences_name_validated(p_prefix in varchar2 default 'SEQ',
07:38:29 187  					p_calling_method in varchar2 ) return boolean is
07:38:29 188   lNamingOK boolean := true;
07:38:29 189   l_calling_method varchar2(200);
07:38:29 190  begin
07:38:29 191  	l_calling_method := nvl(p_calling_method,'EBS_SCHEMA_UTIL.sequences_name_validated');
07:38:29 192  	for i in (
07:38:29 193  	  select sequence_name
07:38:29 194  	  from user_Sequences
07:38:29 195  	  where upper(sequence_name) not like upper(p_prefix||'%')
07:38:29 196  	) loop
07:38:29 197  	    lNamingOK := false;
07:38:29 198  	    Logger(log_msg	 => i.sequence_name || 'should start with '||p_prefix,
07:38:29 199  		   log_type	 => EBS_SCHEMA_UTIL.msg_info,
07:38:29 200  		   object_type	 => 'SEQUENCE',
07:38:29 201  		   OBJECT_NAME	 => i.sequence_name,
07:38:29 202  		   logging_method=> l_calling_method  );
07:38:29 203  	end loop;
07:38:29 204  
07:38:29 205  	return lNamingOK ;
07:38:29 206  end;
07:38:29 207  
07:38:29 208  /* ----------------------------------------------------------- */
07:38:29 209  
07:38:29 210  function FKs_name_validated(p_FK_prefix  in varchar2 default 'FK',
07:38:29 211  				  p_VFK_prefix in varchar2 default 'VFK',
07:38:29 212  				  p_calling_method in varchar2 ) return boolean is
07:38:29 213   lNamingOK boolean := true;
07:38:29 214   l_calling_method varchar2(200);
07:38:29 215  begin
07:38:29 216  	l_calling_method := nvl(p_calling_method,'EBS_SCHEMA_UTIL.FKs_name_validated');
07:38:29 217  	for i in (
07:38:29 218  	  select constraint_name, table_name
07:38:29 219  	  from user_constraints
07:38:29 220  	  where constraint_type='R' --FK constraint
07:38:29 221  	  and (--not valid FK name
07:38:29 222  	       upper(substr(constraint_name,1,length(p_FK_prefix))) <> upper(p_FK_prefix) or
07:38:29 223  	       upper(substr(constraint_name,length(p_FK_prefix)+4)) <> upper(table_name)
07:38:29 224  	      )
07:38:29 225  	  and (-- not valid VFK name
07:38:29 226  	       upper(substr(constraint_name,1,length(p_VFK_prefix))) <> upper(p_VFK_prefix) or
07:38:29 227  	       upper(substr(constraint_name,length(p_VFK_prefix)+4)) <> upper(table_name)
07:38:29 228  	      )
07:38:29 229  	) loop
07:38:29 230  	    lNamingOK := false;
07:38:29 231  	    Logger(log_msg	 => i.constraint_name || ' does not comply the naming convension',
07:38:29 232  		   log_type	 => EBS_SCHEMA_UTIL.msg_info,
07:38:29 233  		   object_type	 => 'SEQUENCE',
07:38:29 234  		   OBJECT_NAME	 => i.table_name ||'.'|| i.constraint_name,
07:38:29 235  		   logging_method=> l_calling_method  );
07:38:29 236  	end loop;
07:38:29 237  
07:38:29 238  	return lNamingOK ;
07:38:29 239  end;
07:38:29 240  
07:38:29 241  /* ----------------------------------------------------------- */
07:38:29 242  procedure check_Objects_naming
07:38:29 243  is
07:38:29 244  begin
07:38:29 245  	Logger(log_msg	     => MSG_START,
07:38:29 246  	       log_type      => MSG_INFO,
07:38:29 247  	       object_type   => null,
07:38:29 248  	       OBJECT_NAME   => 'EBS_SCHEMA_UTIL.check_Objects_naming',
07:38:29 249  	       logging_method => 'EBS_SCHEMA_UTIL.check_Objects_naming'  );
07:38:29 250  	if not(sequences_name_validated(p_calling_method =>'EBS_SCHEMA_UTIL.check_Objects_naming')) or
07:38:29 251  	   not(indecies_name_validated( p_calling_method =>'EBS_SCHEMA_UTIL.check_Objects_naming')) or
07:38:29 252  	   not(views_name_validated(	p_calling_method =>'EBS_SCHEMA_UTIL.check_Objects_naming')) or
07:38:29 253  	   not(mviews_name_validated(	p_calling_method =>'EBS_SCHEMA_UTIL.check_Objects_naming')) or
07:38:29 254  	   not(tables_name_validated(	p_calling_method =>'EBS_SCHEMA_UTIL.check_Objects_naming')) or
07:38:29 255  	   not(FKs_name_validated(	p_calling_method =>'EBS_SCHEMA_UTIL.check_Objects_naming'))
07:38:29 256  	then
07:38:29 257  	   Logger(log_msg	=> MSG_END,
07:38:29 258  		  log_type	=> MSG_ERROR,
07:38:29 259  		  object_type	=> null,
07:38:29 260  		  OBJECT_NAME	=> 'EBS_SCHEMA_UTIL.check_Objects_naming',
07:38:29 261  		  logging_method => 'EBS_SCHEMA_UTIL.check_Objects_naming'  );
07:38:29 262  	   raise_application_error(-20100, 'Objects naming break convention. please validate.');
07:38:29 263  	end if;
07:38:29 264  	Logger(log_msg	     => MSG_END,
07:38:29 265  	       log_type      => MSG_INFO,
07:38:29 266  	       object_type   => null,
07:38:29 267  	       OBJECT_NAME   => 'EBS_SCHEMA_UTIL.check_Objects_naming',
07:38:29 268  	       logging_method => 'EBS_SCHEMA_UTIL.check_Objects_naming'  );
07:38:29 269  end check_Objects_naming;
07:38:29 270  
07:38:29 271  /* ----------------------------------------------------------- */
07:38:29 272  procedure log_uplaod(P_APPLICATION VARCHAR2,
07:38:29 273  			      P_MAJOR	  NUMBER,
07:38:29 274  			      P_MINOR	  NUMBER,
07:38:29 275  			      P_PATCH	  NUMBER,
07:38:29 276  			      P_BUILD		  NUMBER,
07:38:29 277  			      P_STATUS		  VARCHAR2,
07:38:29 278  			      P_COMMENT 	  VARCHAR2) AS
07:38:29 279  begin
07:38:29 280  	 EBS_UPLOAD_UTILS.VERSION_UPLOAD_STATUS(P_APPLICATION, P_MAJOR, P_MINOR, P_PATCH, P_BUILD, P_STATUS, P_COMMENT);
07:38:29 281  end;
07:38:29 282  /* ----------------------------------------------------------- */
07:38:29 283  end EBS_SCHEMA_UTIL;
07:38:29 284  /

Package body created.

Elapsed: 00:00:00.13
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/setVersion.sql  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/setVersion.sql	****/
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> begin
07:38:29   2  	  EBS_SCHEMA_UTIL.log_uplaod('Post Trade',^MAJOR, ^MINOR, to_number(substr('^PATCH',3)), ^EBS, EBS_UPLOAD_UTILS.C_VERSION_START, 'Fresh instalation' );
07:38:29   3  end;
07:38:29   4  /
old   2:     EBS_SCHEMA_UTIL.log_uplaod('Post Trade',^MAJOR, ^MINOR, to_number(substr('^PATCH',3)), ^EBS, EBS_UPLOAD_UTILS.C_VERSION_START, 'Fresh instalation' );
new   2:     EBS_SCHEMA_UTIL.log_uplaod('Post Trade',1, 3, to_number(substr('-p0',3)), 13, EBS_UPLOAD_UTILS.C_VERSION_START, 'Fresh instalation' );

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.14
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/converter.pkg  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/converter.pkg  ****/
07:38:29 SQL> 
07:38:29 SQL> create or replace package converter as
07:38:29   2  function epoch_to_date(epoch_time in number)	    return date      DETERMINISTIC;
07:38:29   3  function epoch_to_timestamp(epoch_time in number)     return timestamp DETERMINISTIC;
07:38:29   4  function date_to_epoch(p_date in date)		    return number    DETERMINISTIC;
07:38:29   5  function timestamp_to_epoch(p_timestamp in timestamp) return number    DETERMINISTIC;
07:38:29   6  end;
07:38:29   7  /

Package created.

Elapsed: 00:00:00.02
07:38:29 SQL> 
07:38:29 SQL> create or replace package body converter as
07:38:29   2   EPOCH_START_DATE    constant date := to_date('19700101','yyyymmdd');
07:38:29   3   EPOCH_START_STMP    constant timestamp := to_timestamp('19700101','yyyymmdd');
07:38:29   4   DAY_MS_RATIO	   constant number := 1/24/60/60/1000;
07:38:29   5  
07:38:29   6  function epoch_to_date(epoch_time in number) return date is
07:38:29   7  begin
07:38:29   8  	      return (EPOCH_START_DATE + epoch_time*DAY_MS_RATIO);
07:38:29   9  end;
07:38:29  10  
07:38:29  11  function epoch_to_timestamp(epoch_time in number) return timestamp is
07:38:29  12  begin
07:38:29  13  	      return (epoch_start_stmp + NumToDSInterval (epoch_time/1000,'SECOND' ));
07:38:29  14  end;
07:38:29  15  
07:38:29  16  function timestamp_to_epoch(p_timestamp in timestamp) return number is
07:38:29  17  begin
07:38:29  18  	      return date_to_epoch(trunc(p_timestamp,'MI'))+extract(second from p_timestamp)*1000;
07:38:29  19  end;
07:38:29  20  
07:38:29  21  function date_to_epoch(p_date in date) return number is
07:38:29  22  begin
07:38:29  23  	      return (p_date-EPOCH_START_DATE)/DAY_MS_RATIO;
07:38:29  24  end;
07:38:29  25  
07:38:29  26  end converter;
07:38:29  27  /

Package body created.

Elapsed: 00:00:00.02
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/version.sql	****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/version.sql  ****/
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/utils/converter.pkg  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/utils/converter.pkg  ****/
07:38:29 SQL> 
07:38:29 SQL> create or replace package converter as
07:38:29   2  function epoch_to_date(epoch_time in number)	    return date      DETERMINISTIC;
07:38:29   3  function epoch_to_timestamp(epoch_time in number)     return timestamp DETERMINISTIC;
07:38:29   4  function date_to_epoch(p_date in date)		    return number    DETERMINISTIC;
07:38:29   5  function timestamp_to_epoch(p_timestamp in timestamp) return number    DETERMINISTIC;
07:38:29   6  end;
07:38:29   7  /

Package created.

Elapsed: 00:00:00.06
07:38:29 SQL> 
07:38:29 SQL> create or replace package body converter as
07:38:29   2   EPOCH_START_DATE    constant date := to_date('19700101','yyyymmdd');
07:38:29   3   EPOCH_START_STMP    constant timestamp := to_timestamp('19700101','yyyymmdd');
07:38:29   4   DAY_MS_RATIO	   constant number := 1/24/60/60/1000;
07:38:29   5  
07:38:29   6  function epoch_to_date(epoch_time in number) return date is
07:38:29   7  begin
07:38:29   8  	      return (EPOCH_START_DATE + epoch_time*DAY_MS_RATIO);
07:38:29   9  end;
07:38:29  10  
07:38:29  11  function epoch_to_timestamp(epoch_time in number) return timestamp is
07:38:29  12  begin
07:38:29  13  	      return (epoch_start_stmp + NumToDSInterval (epoch_time/1000,'SECOND' ));
07:38:29  14  end;
07:38:29  15  
07:38:29  16  function timestamp_to_epoch(p_timestamp in timestamp) return number is
07:38:29  17  begin
07:38:29  18  	      return trunc(date_to_epoch(trunc(p_timestamp,'MI'))+extract(second from p_timestamp)*1000);
07:38:29  19  end;
07:38:29  20  
07:38:29  21  function date_to_epoch(p_date in date) return number is
07:38:29  22  begin
07:38:29  23  	      return (p_date-EPOCH_START_DATE)/DAY_MS_RATIO;
07:38:29  24  end;
07:38:29  25  
07:38:29  26  end converter;
07:38:29  27  /

Package body created.

Elapsed: 00:00:00.04
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/AUDIT_IN.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/AUDIT_IN.table  ****/
07:38:29 SQL> CREATE TABLE AUDIT_IN (
07:38:29   2  	  SOURCE_ID			 NUMBER(10)	      NOT NULL,
07:38:29   3  	  ID				 NUMBER(30)	      NOT NULL,
07:38:29   4  	  -------------------------------------------------------------
07:38:29   5  	  MSG_SESSION			 NUMBER(30)	      NOT NULL,    -- MSL
07:38:29   6  	  MSG_ID			 NUMBER(30)	      NOT NULL,   -- MSL
07:38:29   7  	  MSG_TYPE			 NUMBER(30)	      NOT NULL,   -- MSL
07:38:29   8  	  MSG_TIME			 NUMBER(30), -- Unix time, from MSL
07:38:29   9  	  HDR_VERSION			 NUMBER(10),		  -- currently poh
07:38:29  10  	  UP_VERSION			 NUMBER(10),		   -- currently poh
07:38:29  11  	  MSG_ORIGIN			 NUMBER(30),		 -- currently poh
07:38:29  12  	  MSG_DATA			 BLOB		      DEFAULT NULL,   -- error-specific content (payload/entire msg/whatever)
07:38:29  13  	  -------------------------------------------------------------
07:38:29  14  	  CONTENT_SIZE			 NUMBER(10)	      NOT NULL, -- message payload size (blob size) without header
07:38:29  15  	  -------------------------------------------------------------
07:38:29  16  	  CAPTURE_TIME			 NUMBER(30)	       NOT NULL, -- Unix time, PT Core Service capture time
07:38:29  17  	  STORE_TIME			 TIMESTAMP	       DEFAULT SYSTIMESTAMP NOT NULL, -- should have default value, converting systimestamp to java timestamp
07:38:29  18  	  -------------------------------------------------------------
07:38:29  19  	  STATUS_CODE			 NUMBER(10)	      DEFAULT 0,  -- PT Core Service Error Code
07:38:29  20  	  STATUS_TEXT			 VARCHAR2(2000)       DEFAULT NULL  -- PT Core Service Error Message
07:38:29  21  )
07:38:29  22  PARTITION BY RANGE (STORE_TIME) INTERVAL(NUMTODSINTERVAL(1,'DAY')) --1 day interval
07:38:29  23  (
07:38:29  24  	 PARTITION AUDIT_IN_P0000 VALUES LESS THAN (TO_TIMESTAMP('2015-05-15','yyyy-mm-dd'))
07:38:29  25  )
07:38:29  26  TABLESPACE ^TBL_TBS;
old  26: TABLESPACE ^TBL_TBS
new  26: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.09
07:38:29 SQL> 
07:38:29 SQL> CREATE UNIQUE INDEX PK_AUDIT_IN ON AUDIT_IN(SOURCE_ID, ID) TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_AUDIT_IN ON AUDIT_IN(SOURCE_ID, ID) TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_AUDIT_IN ON AUDIT_IN(SOURCE_ID, ID) TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.02
07:38:29 SQL> ALTER TABLE AUDIT_IN ADD CONSTRAINT PK_AUDIT_IN PRIMARY KEY (SOURCE_ID, ID) USING INDEX;

Table altered.

Elapsed: 00:00:00.01
07:38:29 SQL> 
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.SOURCE_ID IS 'Input source ID';

Comment created.

Elapsed: 00:00:00.04
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.ID IS 'Ascending, unique record ID';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.MSG_SESSION IS 'E.g. MSL session';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.MSG_ID IS 'E.g. MSL ID';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.MSG_TYPE IS 'E.g. MSL namespace + type';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.MSG_TIME IS 'E.g. MSL timestamp';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.HDR_VERSION IS '';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.MSG_ORIGIN IS 'Region';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.CONTENT_SIZE IS 'Size';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.CAPTURE_TIME IS 'Processing start timestamp';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.STORE_TIME IS 'Persistence timestamp';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.STATUS_CODE IS 'Status code';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.STATUS_TEXT IS 'Text description';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_IN.MSG_DATA IS 'Null if success, otherwise the error-producing content (e.g. the payload that cannot be parsed as expected)';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/AUDIT_OUT.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/AUDIT_OUT.table	****/
07:38:29 SQL> CREATE TABLE AUDIT_OUT (
07:38:29   2  	  TARGET_ID			 NUMBER(10)	      NOT NULL,
07:38:29   3  	  ID				 NUMBER(30)	      NOT NULL,
07:38:29   4  	  -------------------------------------------------------------
07:38:29   5  	  MSG_SESSION			 NUMBER(30)	      NOT NULL,    -- MSL
07:38:29   6  	  MSG_ID			 NUMBER(30)	      NOT NULL,   -- MSL
07:38:29   7  	  MSG_DATA			 BLOB		      DEFAULT NULL,   -- TODO content that the adapter failed to sent
07:38:29   8  	  -------------------------------------------------------------
07:38:29   9  --    CONTENT_SIZE		   NUMBER(10)		NOT NULL, -- message payload size (blob size) without header
07:38:29  10  	  -------------------------------------------------------------
07:38:29  11  	  CAPTURE_TIME			 NUMBER(30)	       NOT NULL, -- Unix time, adapter capture time
07:38:29  12  	  SEND_TIME			 TIMESTAMP	       DEFAULT SYSTIMESTAMP NOT NULL, -- should have default value, converting systimestamp to java timestamp
07:38:29  13  	  -------------------------------------------------------------
07:38:29  14  	  STATUS_CODE			 NUMBER(10)	      DEFAULT 0,  -- Adapter Service Error Code
07:38:29  15  	  STATUS_TEXT			 VARCHAR2(2000)       DEFAULT NULL  -- PT Core Service Error Message
07:38:29  16  )
07:38:29  17  PARTITION BY RANGE (SEND_TIME) INTERVAL(NUMTODSINTERVAL(1,'DAY')) --1 day interval
07:38:29  18  (
07:38:29  19  	 PARTITION AUDIT_OUT_P0000 VALUES LESS THAN (TO_TIMESTAMP('2015-05-15','yyyy-mm-dd'))
07:38:29  20  )
07:38:29  21  TABLESPACE ^TBL_TBS;
old  21: TABLESPACE ^TBL_TBS
new  21: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.03
07:38:29 SQL> 
07:38:29 SQL> CREATE UNIQUE INDEX PK_AUDIT_OUT ON AUDIT_OUT(TARGET_ID, ID) TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_AUDIT_OUT ON AUDIT_OUT(TARGET_ID, ID) TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_AUDIT_OUT ON AUDIT_OUT(TARGET_ID, ID) TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.07
07:38:29 SQL> ALTER TABLE AUDIT_OUT ADD CONSTRAINT PK_AUDIT_OUT PRIMARY KEY (TARGET_ID, ID) USING INDEX;

Table altered.

Elapsed: 00:00:00.01
07:38:29 SQL> 
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.TARGET_ID IS 'Output target ID';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.ID IS 'Ascending, unique record ID';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.MSG_SESSION IS 'E.g. MSL session of the corresponding input message';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.MSG_ID IS 'E.g. MSL ID of the corresponding input message';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.MSG_DATA IS 'Content that the adapter failed to send';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.CAPTURE_TIME IS 'Processing start timestamp';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.SEND_TIME IS 'Sent timestamp';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.STATUS_CODE IS 'Status code';

Comment created.

Elapsed: 00:00:00.00
07:38:29 SQL> COMMENT ON COLUMN AUDIT_OUT.STATUS_TEXT IS 'Text description';

Comment created.

Elapsed: 00:00:00.01
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> 
07:38:29 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/FX_DEAL_LEG.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/FX_DEAL_LEG.table  ****/
07:38:29 SQL> CREATE TABLE FX_DEAL_LEG (
07:38:29   2  	      EXEC_ID			     CHAR(17)		  NOT NULL,
07:38:29   3  	      EFP_EXEC_SIDE		     CHAR(1)		  NOT NULL,
07:38:29   4  	      GENERATION		     CHAR(1)		  NOT NULL,
07:38:29   5  	      LEG_TYPE			     CHAR(1)		  NOT NULL,
07:38:29   6  	      COMPOSITE 		     CHAR(1)		  NOT NULL,
07:38:29   7  	      EFP_INSTITUTION_KEY	     NUMBER(30) 	  NOT NULL,
07:38:29   8  	      DOMAIN_ID 		     NUMBER(10) 	  NOT NULL,
07:38:29   9  	      FP_SIDE			     NUMBER(1)		  NOT NULL,
07:38:29  10  	      PX_EFFECTIVE		     NUMBER(30),
07:38:29  11  	      PX_EFFECTIVE_EXP		     NUMBER(10),
07:38:29  12  	      PX_ALLIN			     NUMBER(30),
07:38:29  13  	      PX_EXP			     NUMBER(10),
07:38:29  14  	      PX_BD_BASE		     NUMBER(30),
07:38:29  15  	      PX_BD_TRADER		     NUMBER(30),
07:38:29  16  	      PX_BD_SALESM		     NUMBER(30),
07:38:29  17  	      PX_BD_ECOM		     NUMBER(30),
07:38:29  18  	      PX_BD_VENUE		     NUMBER(30),
07:38:29  19  	      PX_SPOT_ALLIN		     NUMBER(30),
07:38:29  20  	      PX_SPOT_EXP		     NUMBER(10),
07:38:29  21  	      PX_SPOT_BD_BASE		     NUMBER(30),
07:38:29  22  	      PX_SPOT_BD_TRADER 	     NUMBER(30),
07:38:29  23  	      PX_SPOT_BD_SALESM 	     NUMBER(30),
07:38:29  24  	      PX_SPOT_BD_ECOM		     NUMBER(30),
07:38:29  25  	      PX_SPOT_BD_VENUE		     NUMBER(30),
07:38:29  26  	      PX_FWDP_ALLIN		     NUMBER(30),
07:38:29  27  	      PX_FWDP_EXP		     NUMBER(10),
07:38:29  28  	      PX_FWDP_BD_BASE		     NUMBER(30),
07:38:29  29  	      PX_FWDP_BD_TRADER 	     NUMBER(30),
07:38:29  30  	      PX_FWDP_BD_SALESM 	     NUMBER(30),
07:38:29  31  	      PX_FWDP_BD_ECOM		     NUMBER(30),
07:38:29  32  	      PX_FWDP_BD_VENUE		     NUMBER(30),
07:38:29  33  	      QTY_DEALT 		     NUMBER(30),
07:38:29  34  	      QTY_DEALT_EXP		     NUMBER(10),
07:38:29  35  	      QTY_CNTR			     NUMBER(30),
07:38:29  36  	      QTY_CNTR_EXP		     NUMBER(10),
07:38:29  37  	      DATE_SETTLEMENT		     NUMBER(30) 	  NOT NULL,
07:38:29  38  	      DATE_MATURITY		     NUMBER(30),
07:38:29  39  	      TENOR_TYPE		     NUMBER(10),
07:38:29  40  	      TENOR_VALUE		     NUMBER(10),
07:38:29  41  	      END_DATE			     NUMBER(30) 	  NOT NULL
07:38:29  42  )
07:38:29  43  PARTITION BY HASH(EFP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS ^PARTITIONS_NUM
07:38:29  44  TABLESPACE ^TBL_TBS;
old  43: PARTITION BY HASH(EFP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS ^PARTITIONS_NUM
new  43: PARTITION BY HASH(EFP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS 50
old  44: TABLESPACE ^TBL_TBS
new  44: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.19
07:38:30 SQL> 
07:38:30 SQL> CREATE UNIQUE INDEX PK_FX_DEAL_LEG ON FX_DEAL_LEG(EXEC_ID, EFP_EXEC_SIDE, GENERATION, LEG_TYPE, COMPOSITE, EFP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_FX_DEAL_LEG ON FX_DEAL_LEG(EXEC_ID, EFP_EXEC_SIDE, GENERATION, LEG_TYPE, COMPOSITE, EFP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_FX_DEAL_LEG ON FX_DEAL_LEG(EXEC_ID, EFP_EXEC_SIDE, GENERATION, LEG_TYPE, COMPOSITE, EFP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.08
07:38:30 SQL> ALTER TABLE FX_DEAL_LEG ADD CONSTRAINT PK_FX_DEAL_LEG PRIMARY KEY (EXEC_ID, EFP_EXEC_SIDE, GENERATION, LEG_TYPE, COMPOSITE, EFP_INSTITUTION_KEY, DOMAIN_ID) USING INDEX LOCAL;

Table altered.

Elapsed: 00:00:00.01
07:38:30 SQL> 
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.EXEC_ID IS 'execId XXXX-XXXX-XXXX-XX';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.EFP_EXEC_SIDE IS 'S - side 1- Taker/LC,  2-Maker/LP';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.GENERATION IS 'G - Generation 0, 1 for fix price update';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.LEG_TYPE IS 'L - Number(0-2): 0 for SPOT or OT, 0 for Swap if user wants to receive both legs on a single ticket,  1 for Near leg of swap,	2 for Far leg of swap';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.COMPOSITE IS 'C - Hexadecimal (0-F) 0-non-composite, 1 - basket trade with synthetic instrument, 2-F: non-synthetic components of a composite trade';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.FP_SIDE IS '[0] BUY, [1] SELL';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_EFFECTIVE IS 'The price of this leg. May be positive, negative, or zero. Not provided for trades which have not yet been fixed.
07:38:30   2  The all-in price of this leg of the trade. Includes any relevant white label markups for this leg.
07:38:30   3  Does not include prime spread.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_ALLIN IS 'The price of this leg. May be positive, negative, or zero. Not provided for trades which have not yet been fixed.
07:38:30   2  The all-in price of this leg of the trade. Includes any relevant white label markups for this leg.
07:38:30   3  Does not include prime spread.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_BD_BASE IS 'Raw market rate to which all the markup rates are applied.  Rate without markup.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_BD_TRADER IS 'Trader markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_BD_SALESM IS 'Sales markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_BD_ECOM IS 'eCom markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_BD_VENUE IS 'Venue markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_SPOT_ALLIN IS 'Reference rate against which the forwardPoints are to be applied.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_SPOT_BD_BASE IS 'Raw market rate to which all the markup rates are applied.  Rate without markup.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_SPOT_BD_TRADER IS 'Trader markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_SPOT_BD_SALESM IS 'Sales markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_SPOT_BD_ECOM IS 'eCom markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_SPOT_BD_VENUE IS 'Venue markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_FWDP_ALLIN IS 'Relevant for Outright and Swap trades only. Forward points added to a spot rate to calculate the all-in price.	May be a positive, negative, or zero.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_FWDP_BD_BASE IS 'Raw market rate to which all the markup rates are applied.  Rate without markup.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_FWDP_BD_TRADER IS 'Trader markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_FWDP_BD_SALESM IS 'Sales markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_FWDP_BD_ECOM IS 'eCom markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.PX_FWDP_BD_VENUE IS 'Venue markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.QTY_CNTR IS 'Contra-size of this leg, in units of the contra Asset.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.DATE_SETTLEMENT IS 'The settlement date of this leg. For SPOT deals, this is the Value Date (aka Settlement Date)
07:38:30   2  For NDF, it is the NDF Settlement Date (not the fixing date). Not present on BASKET indicative leg.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.DATE_MATURITY IS 'Relevant for NDF legs only. NDF fixing date of the leg.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.TENOR_TYPE IS 'Tenor type of this leg:
07:38:30   2  [12] Spot Spot date
07:38:30   3  [1] T Days after trade date.
07:38:30   4  [2] D Days after spot value date
07:38:30   5  [3] Wk Week after spot date
07:38:30   6  [4] Mth Month after spot date
07:38:30   7  [5] Yr Years
07:38:30   8  [7] IMM_Q Quarterly IMM. Next nth IMM after Spot date.
07:38:30   9  [20] Broken Broken dates';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.TENOR_VALUE IS 'Relevant only for NDF, NDF Swap, OT or FX Swap:
07:38:30   2  Value of tenorType (#  of days, weeks, years, IMMs)
07:38:30   3  Required for tenorTypes:	DAYS , WEEKS, MONTHS, YEARS , ROLLING _IMM , & FIXED _IMM.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL_LEG.END_DATE IS 'The date after which the record can be archived (subj. to the retention policy)';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> 
07:38:30 SQL> 
07:38:30 SQL> 
07:38:30 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/FX_DEAL.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/FX_DEAL.table  ****/
07:38:30 SQL> CREATE TABLE FX_DEAL (
07:38:30   2  	      SOURCE_ID 		     NUMBER(10) 	  DEFAULT 0	       NOT NULL,
07:38:30   3  	      AUDIT_ID			     NUMBER(30) 	  DEFAULT 0	       NOT NULL,
07:38:30   4  	      EXEC_ID			     CHAR(17)		  NOT NULL,
07:38:30   5  	      EFP_EXEC_SIDE		     CHAR(1)		  NOT NULL,
07:38:30   6  	      EFP_INSTITUTION_KEY	     NUMBER(30) 	  NOT NULL,
07:38:30   7  	      DOMAIN_ID 		     NUMBER(10) 	  NOT NULL,
07:38:30   8  	      TXN_TIME			     NUMBER(30) 	  NOT NULL,
07:38:30   9  	      EXEC_ID2			     VARCHAR2(64),
07:38:30  10  	      TRADE_DATE		     NUMBER(30),
07:38:30  11  	      SPOT_SETTL_DATE		     NUMBER(30),
07:38:30  12  	      PX_SWAP_POINTS		     NUMBER(30),
07:38:30  13  	      PX_SWAP_POINTS_EXP	     NUMBER(10),
07:38:30  14  	      MARKET_SEGMENT		     NUMBER(30),
07:38:30  15  	      ECN			     NUMBER(10),
07:38:30  16  	      ALGO_TYPE 		     NUMBER(10),
07:38:30  17  	      INSTR_SEC_ID		     NUMBER(30),
07:38:30  18  	      INSTR_SYMBOL		     VARCHAR2(16)	  NOT NULL,
07:38:30  19  	      INSTR_PRODUCT_TYPE	     VARCHAR2(3)	  NOT NULL,
07:38:30  20  	      IS_TERM_CCY		     NUMBER(1),
07:38:30  21  	      ASSET_BASE		     VARCHAR2(8)	  NOT NULL,
07:38:30  22  	      ASSET_COUNTER		     VARCHAR2(8)	  NOT NULL,
07:38:30  23  	      EFP_EBS_ORDER_ID		     VARCHAR2(64),
07:38:30  24  	      EFP_ORDER_ID		     VARCHAR2(64),
07:38:30  25  	      ECP_ORDER_ID		     VARCHAR2(64),
07:38:30  26  	      EFP_INSTITUTION		     VARCHAR2(16),
07:38:30  27  	      EFP_ROLE			     CHAR(1)		  NOT NULL,
07:38:30  28  	      EFP_ACCOUNT		     VARCHAR2(16),
07:38:30  29  	      EFP_FLOOR 		     VARCHAR2(16)	  NOT NULL,
07:38:30  30  	      EFP_FLOOR_KEY		     NUMBER(30) 	  NOT NULL,
07:38:30  31  	      EFP_TRADER		     VARCHAR2(16),
07:38:30  32  	      EFP_LEI			     VARCHAR2(20),
07:38:30  33  	      EFP_CLIENT		     VARCHAR2(64),
07:38:30  34  	      ECP_INSTITUTION_KEY	     NUMBER(30) 	  NOT NULL,
07:38:30  35  	      ECP_INSTITUTION		     VARCHAR2(16)	  NOT NULL,
07:38:30  36  	      ECP_ROLE			     CHAR(1)		  NOT NULL,
07:38:30  37  	      ECP_ACCOUNT		     VARCHAR2(16),
07:38:30  38  	      ECP_FLOOR 		     VARCHAR2(16)	  NOT NULL,
07:38:30  39  	      ECP_FLOOR_KEY		     NUMBER(30) 	  NOT NULL,
07:38:30  40  	      ECP_TRADER		     VARCHAR2(16),
07:38:30  41  	      ECP_LEI			     VARCHAR2(20),
07:38:30  42  	      ECP_CLIENT		     VARCHAR2(64),
07:38:30  43  	      IND_UNSOLICITED		     NUMBER(1),
07:38:30  44  	      ORD_TYPE			     NUMBER(10) 	  NOT NULL,
07:38:30  45  	      ORD_TIME_IN_FORCE 	     NUMBER(10) 	  NOT NULL,
07:38:30  46  	      ORD_EXPOSURE		     NUMBER(10),
07:38:30  47  	      ORD_SIDE			     NUMBER(1)		  NOT NULL,
07:38:30  48  	      ORD_PX_PD 		     NUMBER(30),
07:38:30  49  	      ORD_PX_PD_EXP		     NUMBER(10),
07:38:30  50  	      ORD_PX_SWAP_POINTS	     NUMBER(30),
07:38:30  51  	      ORD_PX_SWAP_POINTS_EXP	     NUMBER(10),
07:38:30  52  	      ORD_SUBMITTER_TYPE	     NUMBER(10) 	  NOT NULL,
07:38:30  53  	      ORD_SUBMITTER_NAME	     VARCHAR2(64),
07:38:30  54  	      ORD_QUOTE_ID		     NUMBER(30),
07:38:30  55  	      ORD_QUOTE_REQUEST_ID	     NUMBER(30),
07:38:30  56  	      END_DATE			     NUMBER(30) 	  NOT NULL
07:38:30  57  )
07:38:30  58  PARTITION BY HASH(EFP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS ^PARTITIONS_NUM
07:38:30  59  TABLESPACE ^TBL_TBS;
old  58: PARTITION BY HASH(EFP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS ^PARTITIONS_NUM
new  58: PARTITION BY HASH(EFP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS 50
old  59: TABLESPACE ^TBL_TBS
new  59: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.14
07:38:30 SQL> 
07:38:30 SQL> CREATE UNIQUE INDEX PK_FX_DEAL ON FX_DEAL(EXEC_ID, EFP_EXEC_SIDE, EFP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_FX_DEAL ON FX_DEAL(EXEC_ID, EFP_EXEC_SIDE, EFP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_FX_DEAL ON FX_DEAL(EXEC_ID, EFP_EXEC_SIDE, EFP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.09
07:38:30 SQL> ALTER TABLE FX_DEAL ADD CONSTRAINT PK_FX_DEAL PRIMARY KEY (EXEC_ID, EFP_EXEC_SIDE, EFP_INSTITUTION_KEY, DOMAIN_ID) USING INDEX LOCAL;

Table altered.

Elapsed: 00:00:00.01
07:38:30 SQL> 
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.SOURCE_ID IS 'references';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EXEC_ID IS 'execId XXXX-XXXX-XXXX-XX';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_EXEC_SIDE IS 'Y = Aggressor (Taker)   N = Passive (Maker ) ==>   1- Taker/LC,  2-Maker/LP';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.TXN_TIME IS 'Timestamp of the trade on the execution platform. For EBSD trades - the timestamp provided by the LP.
07:38:30   2  This is not sending time, this is actual execution time';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EXEC_ID2 IS 'LP assigned Trade Identifier. Required on all EBSD trades where ExecType = TRADE.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.TRADE_DATE IS 'Effective business date of the transaction, based on EOD rules.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.SPOT_SETTL_DATE IS 'Relevant for NDF, FWD, NDF SWAP, & FX SWAP legs only. The settlement date of the associated SPOT pair.
07:38:30   2  Spot settlement date will be the same for all legs (since doesnt consider tenor.)';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.PX_SWAP_POINTS IS 'Relevant for Swap trades only. Difference between the all-in rate of the far leg and the near leg.
07:38:30   2  May be a positive, negative, or zero.
07:38:30   3  For FX_SWAP, the SwapPoints  at which the swap was executed. Equals (TradePx2  TradePx1).
07:38:30   4  Expressed in full price form. For example, 61.99 points, when representing 0.006199, is sent as 6199 x 10-6';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.MARKET_SEGMENT IS 'Market Segment of instrument:
07:38:30   2   EBSM - EBS Market [1]
07:38:30   3   EBSD - EBS  Direct [2]
07:38:30   4   EBSD_FA  EBS Direct Full Amount [3]
07:38:30   5   EBSD_RFQ[4]
07:38:30   6   EBSM_HEDGE[5]';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECN IS '20 - EBSM, 21 - EBSD, 22 - EBSH  23 - xxxx , 24 - yyyyy';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ALGO_TYPE IS '20 - SWEEP, 21 - FULL 22 - RFQ,';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.INSTR_SEC_ID IS 'Execution system instrument id, unique in scope of execution system (marketSegment)';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.INSTR_SYMBOL IS 'Standard representation of currency pair, .e.g EUR/USD. Does not include tenor or security type.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.INSTR_PRODUCT_TYPE IS 'SPT, FWD, FXS, NDF, NDS';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.IS_TERM_CCY IS 'Indicates whether the Dealt Currency of the trade is the Term Currency (CCY2).
07:38:30   2  All quantities and sides specified in the TCR are expressed in terms of the Dealt Currency.
07:38:30   3  Default=False (Dealt Currency is Base Currency, CCY1.)';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ASSET_BASE IS 'Three character ISO code of the base currency of this leg.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ASSET_COUNTER IS 'Three character ISO code of the base currency of this leg.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_EBS_ORDER_ID IS 'OrderId assigned by EBS to partys order. EBS orderId is always 14 ascii characters  xxxx-xxxx-xxxx, including hyphens.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_ORDER_ID IS 'FirstPartys clOrdId which resulted in this trade. If firstParty is a Prime Broker or IntroducingAgent, this is the clOrdId of the Executing Party on this side of the transaction. Note that clOrdId is not globally unique.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_ORDER_ID IS 'LP OrderId, as assigned by the LP.  Echoed from OrderID[37] on LP ER.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_INSTITUTION IS 'First Party Institution Code';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_ACCOUNT IS 'First Party Account';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_FLOOR IS 'First Party Floor Code';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_FLOOR_KEY IS 'First Party Floor KEY';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.EFP_TRADER IS 'First Party  (3 chars) EBS Trader ID';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_INSTITUTION_KEY IS 'Counter Party Institution Key';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_INSTITUTION IS 'Counter Party Institution Code';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_ACCOUNT IS 'Account';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_FLOOR IS 'Counter Party Floor Code';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_FLOOR_KEY IS 'Counter Party Floor Key';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ECP_TRADER IS 'Counter Party (3 chars) EBS Trader ID. Enrichment -populated after internal match?';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.IND_UNSOLICITED IS 'Indicates that a trade is being submitted for trade registration outside the context of order submission, i.e. the NOS was not submitted on this session. Default False (NULL in DB)';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_TYPE IS 'Type of order:  LIMIT [0] (Default)  PQ [1] - Previously Quoted (for RFQ)';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_TIME_IN_FORCE IS ' IOC [1]  immediate or cancel   TTL[2]  time to live	 GTC[3]  good until cancelled';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_EXPOSURE IS 'Time to live of a TTL order, in milliseconds. Offset applied to EBS order receipt time.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_SIDE IS 'Top-level side of the order from the client perspective, in terms of the trades Dealt Currency
07:38:30   2  For Swaps, this is the side of the far leg of the transaction.	BUY[0] = Sell/Buy 	    SELL[1] =  Buy/Sell
07:38:30   3  Required for multileg orders. (FX_SWAP, FX_NDS, BASKET).	For single leg transactions, side is in TradeLeg.';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_PX_PD IS 'Unsigned PD (Price Discretion) offset to be applied to the swap points. Absolute value. If isTermCcy=FALSE, offset is added to the bid and subtracted from the offer. If isTermCcy=TRUE, then the offset is subtracted from the bid and added to the offer. Default=0';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_PX_SWAP_POINTS IS 'For swap, the points-based price for the swap order as a whole, indicating the desired spread between the all-in rates of the far leg and near leg.  Expressed in full price form. For example, 61.99 points, when representing 0.006199, is sent as 6199 x 10-6';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_SUBMITTER_TYPE IS 'Access method of the order submitter. When provided, echoed from NOS';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_SUBMITTER_NAME IS 'Name of third-party client access vendor, for those not specified by accessMethod enumeration. When provided, echoed from NOS.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_QUOTE_ID IS 'For PQ orders, the targeted quoteId from Quote msg.When provided, echoed from NOS';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.ORD_QUOTE_REQUEST_ID IS 'If the NOS was submitted as part of an RFQ session, references the client RFQ session id. Required on client RFQ ER from GW.';

Comment created.

Elapsed: 00:00:00.00
07:38:30 SQL> COMMENT ON COLUMN FX_DEAL.END_DATE IS 'The date after which the record can be archived (subj. to the retention policy)';

Comment created.

Elapsed: 00:00:00.01
07:38:30 SQL> 
07:38:30 SQL> 
07:38:30 SQL> 
07:38:30 SQL> 
07:38:30 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/FX_TICKET_LEG.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/FX_TICKET_LEG.table  ****/
07:38:30 SQL> CREATE TABLE FX_TICKET_LEG (
07:38:30   2  	      ID			     CHAR(24)		  NOT NULL,
07:38:30   3  	      FP_INSTITUTION_KEY	     NUMBER(30) 	  NOT NULL,
07:38:30   4  	      DOMAIN_ID 		     NUMBER(10) 	  NOT NULL,
07:38:30   5  	      EXEC_ID			     CHAR(17)		  NOT NULL,
07:38:30   6  	      EFP_EXEC_SIDE		     CHAR(1)		  NOT NULL,
07:38:30   7  	      GENERATION		     CHAR(1)		  NOT NULL,
07:38:30   8  	      LEG_TYPE			     CHAR(1)		  NOT NULL,
07:38:30   9  	      COMPOSITE 		     CHAR(1)		  NOT NULL,
07:38:30  10  	      TICKET_TYPE		     NUMBER(3),
07:38:30  11  	      TXN_TIME			     NUMBER(30) 	  NOT NULL,
07:38:30  12  	      EXEC_ID2			     VARCHAR2(64),
07:38:30  13  	      INSTR_SEC_ID		     NUMBER(30),
07:38:30  14  	      INSTR_SYMBOL		     VARCHAR2(16)	  NOT NULL,
07:38:30  15  	      INSTR_PRODUCT_TYPE	     VARCHAR2(3)	  NOT NULL,
07:38:30  16  	      MARKET_SEGMENT		     NUMBER(30),
07:38:30  17  	      ECN			     NUMBER(10),
07:38:30  18  	      ALGO_TYPE 		     NUMBER(10),
07:38:30  19  	      TENOR_TYPE		     NUMBER(10),
07:38:30  20  	      TENOR_VALUE		     NUMBER(10),
07:38:30  21  	      DATE_SETTLEMENT		     NUMBER(30) 	  NOT NULL,
07:38:30  22  	      DATE_MATURITY		     NUMBER(30),
07:38:30  23  	      TRADE_DATE		     NUMBER(30) 	  NOT NULL,
07:38:30  24  	      SPOT_SETTL_DATE		     NUMBER(30),
07:38:30  25  	      IS_TERM_CCY		     NUMBER(1),
07:38:30  26  	      CCY_DEALT 		     CHAR(3)		  NOT NULL,
07:38:30  27  	      CCY_CONTRA		     CHAR(3)		  NOT NULL,
07:38:30  28  	      QTY_DEALT 		     NUMBER(30),
07:38:30  29  	      QTY_DEALT_EXP		     NUMBER(10),
07:38:30  30  	  VC_QTY_DEALT			 NUMBER GENERATED ALWAYS AS (QTY_DEALT*POWER(10,QTY_DEALT_EXP)) VIRTUAL,
07:38:30  31  	      QTY_CNTR			     NUMBER(30),
07:38:30  32  	      QTY_CNTR_EXP		     NUMBER(10),
07:38:30  33  	VC_QTY_CNTR		       NUMBER GENERATED ALWAYS AS (QTY_CNTR*POWER(10,QTY_CNTR_EXP)) VIRTUAL,
07:38:30  34  	      PX_SWAP_POINTS		     NUMBER(30),
07:38:30  35  	      PX_SWAP_POINTS_EXP	     NUMBER(10),
07:38:30  36  	  VC_PX_SWAP_POINTS		 NUMBER GENERATED ALWAYS AS (PX_SWAP_POINTS*POWER(10,PX_SWAP_POINTS_EXP)) VIRTUAL,
07:38:30  37  	      PX_ALLIN			     NUMBER(30),
07:38:30  38  	      PX_EXP			     NUMBER(10),
07:38:30  39  	  VC_PX_ALLIN			 NUMBER GENERATED ALWAYS AS (PX_ALLIN*POWER(10,PX_EXP)) VIRTUAL,
07:38:30  40  	      PX_BD_BASE		     NUMBER(30),
07:38:30  41  	      PX_BD_TRADER		     NUMBER(30),
07:38:30  42  	      PX_BD_SALESM		     NUMBER(30),
07:38:30  43  	      PX_BD_ECOM		     NUMBER(30),
07:38:30  44  	      PX_BD_VENUE		     NUMBER(30),
07:38:30  45  	      PX_SPOT_ALLIN		     NUMBER(30),
07:38:30  46  	      PX_SPOT_EXP		     NUMBER(10),
07:38:30  47  	      PX_SPOT_BD_BASE		     NUMBER(30),
07:38:30  48  	      PX_SPOT_BD_TRADER 	     NUMBER(30),
07:38:30  49  	      PX_SPOT_BD_SALESM 	     NUMBER(30),
07:38:30  50  	      PX_SPOT_BD_ECOM		     NUMBER(30),
07:38:30  51  	      PX_SPOT_BD_VENUE		     NUMBER(30),
07:38:30  52  	      PX_FWDP_ALLIN		     NUMBER(30),
07:38:30  53  	      PX_FWDP_EXP		     NUMBER(10),
07:38:30  54  	  VC_PX_FWDP_ALLIN		 NUMBER GENERATED ALWAYS AS (PX_FWDP_ALLIN*POWER(10,PX_FWDP_EXP)) VIRTUAL,
07:38:30  55  	      PX_FWDP_BD_BASE		     NUMBER(30),
07:38:30  56  	      PX_FWDP_BD_TRADER 	     NUMBER(30),
07:38:30  57  	      PX_FWDP_BD_SALESM 	     NUMBER(30),
07:38:30  58  	      PX_FWDP_BD_ECOM		     NUMBER(30),
07:38:30  59  	      PX_FWDP_BD_VENUE		     NUMBER(30),
07:38:30  60  	      PX_PRIME_SPREAD		     NUMBER(30),
07:38:30  61  	      PX_PRIME_SPREAD_EXP	     NUMBER(10),
07:38:30  62  	  VC_PX_PRIME_SPREAD		 NUMBER GENERATED ALWAYS AS (PX_PRIME_SPREAD*POWER(10,PX_PRIME_SPREAD_EXP)) VIRTUAL,
07:38:30  63  	      PX_EFFECTIVE		     NUMBER(30),
07:38:30  64  	      PX_EFFECTIVE_EXP		     NUMBER(10),
07:38:30  65  	  VC_PX_EFFECTIVE		 NUMBER GENERATED ALWAYS AS (PX_EFFECTIVE*POWER(10,PX_EFFECTIVE_EXP)) VIRTUAL,
07:38:30  66  	      FP_EXEC_SIDE		     CHAR(1)		  NOT NULL,
07:38:30  67  	      FP_SIDE			     NUMBER(1)		  NOT NULL,
07:38:30  68  	      FP_ROLE			     CHAR(1)		  NOT NULL,
07:38:30  69  	      FP_ACCOUNT		     VARCHAR2(16)	  NOT NULL,
07:38:30  70  	      FP_FLOOR_KEY		     NUMBER(30) 	  NOT NULL,
07:38:30  71  	      FP_FLOOR			     CHAR(4)		  NOT NULL,
07:38:30  72  	      FP_TRADER 		     VARCHAR2(16),
07:38:30  73  	      FP_INSTITUTION		     VARCHAR2(16)	  NOT NULL,
07:38:30  74  	      FP_LEI			     VARCHAR2(20),
07:38:30  75  	      FP_CLIENT 		     VARCHAR2(64),
07:38:30  76  	      FP_SI_TYPE		     NUMBER(10) 	  NOT NULL,
07:38:30  77  	      FP_SI_CCY 		     CHAR(3)		  NOT NULL,
07:38:30  78  	      FP_SI_BANK		     VARCHAR2(16),
07:38:30  79  	      FP_SI_BANK_BIC		     VARCHAR2(16),
07:38:30  80  	      FP_SI_BANK_ACC		     VARCHAR2(16),
07:38:30  81  	      FP_SI_BANK_LOCATION	     VARCHAR2(64),
07:38:30  82  	      FP_SI_BANK_CITYCODE	     VARCHAR2(16),
07:38:30  83  	      CP_ROLE			     CHAR(1)		  NOT NULL,
07:38:30  84  	      CP_ACCOUNT		     VARCHAR2(16)	  NOT NULL,
07:38:30  85  	      CP_FLOOR_KEY		     NUMBER(30) 	  NOT NULL,
07:38:30  86  	      CP_FLOOR			     CHAR(4)		  NOT NULL,
07:38:30  87  	      CP_TRADER 		     VARCHAR2(16),
07:38:30  88  	      CP_INSTITUTION		     VARCHAR2(16)	  NOT NULL,
07:38:30  89  	      CP_INSTITUTION_KEY	     NUMBER(30) 	  NOT NULL,
07:38:30  90  	      CP_LEI			     VARCHAR2(20),
07:38:30  91  	      CP_CLIENT 		     VARCHAR2(64),
07:38:30  92  	      CP_SI_TYPE		     NUMBER(10) 	  NOT NULL,
07:38:30  93  	      CP_SI_CCY 		     CHAR(3)		  NOT NULL,
07:38:30  94  	      CP_SI_BANK		     VARCHAR2(16),
07:38:30  95  	      CP_SI_BANK_BIC		     VARCHAR2(16),
07:38:30  96  	      CP_SI_BANK_ACC		     VARCHAR2(16),
07:38:30  97  	      CP_SI_BANK_LOCATION	     VARCHAR2(64),
07:38:30  98  	      CP_SI_BANK_CITYCODE	     VARCHAR2(16),
07:38:30  99  	      EFP_EBS_ORDER_ID		     VARCHAR2(64),
07:38:30 100  	      EFP_ORDER_ID		     VARCHAR2(64),
07:38:30 101  	      END_DATE			     NUMBER(30) 	  NOT NULL,
07:38:30 102  	      AUDIT_ID			     NUMBER(30) 	  NOT NULL
07:38:30 103  )
07:38:30 104  PARTITION BY HASH(FP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS ^PARTITIONS_NUM
07:38:30 105  TABLESPACE ^TBL_TBS;
old 104: PARTITION BY HASH(FP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS ^PARTITIONS_NUM
new 104: PARTITION BY HASH(FP_INSTITUTION_KEY, DOMAIN_ID) PARTITIONS 50
old 105: TABLESPACE ^TBL_TBS
new 105: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.16
07:38:30 SQL> 
07:38:30 SQL> CREATE UNIQUE INDEX PK_FX_TICKET_LEG ON FX_TICKET_LEG(ID, FP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_FX_TICKET_LEG ON FX_TICKET_LEG(ID, FP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_FX_TICKET_LEG ON FX_TICKET_LEG(ID, FP_INSTITUTION_KEY, DOMAIN_ID) LOCAL TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.06
07:38:30 SQL> ALTER TABLE FX_TICKET_LEG ADD CONSTRAINT PK_FX_TICKET_LEG PRIMARY KEY (ID, FP_INSTITUTION_KEY, DOMAIN_ID) USING INDEX LOCAL;

Table altered.

Elapsed: 00:00:00.02
07:38:30 SQL> 
07:38:30 SQL> CREATE INDEX FX_TICKET_LEG_IDX1 ON FX_TICKET_LEG (FP_INSTITUTION_KEY, DOMAIN_ID, FP_FLOOR, AUDIT_ID) LOCAL TABLESPACE ^IDX_TBS;
old   1: CREATE INDEX FX_TICKET_LEG_IDX1 ON FX_TICKET_LEG (FP_INSTITUTION_KEY, DOMAIN_ID, FP_FLOOR, AUDIT_ID) LOCAL TABLESPACE ^IDX_TBS
new   1: CREATE INDEX FX_TICKET_LEG_IDX1 ON FX_TICKET_LEG (FP_INSTITUTION_KEY, DOMAIN_ID, FP_FLOOR, AUDIT_ID) LOCAL TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.24
07:38:31 SQL> 
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.ID IS 'XXXX-XXXX-XXXX-XX-XXXXXX';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.EXEC_ID IS 'execId';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.EFP_EXEC_SIDE IS 'S - side 1- Taker/LC,  2-Maker/LP';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.GENERATION IS 'G - Generation 0, 1 for fix price update';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.LEG_TYPE IS 'L - Number(0-2): 0 for SPOT or OT, 0 for Swap if user wants to receive both legs on a single ticket,  1 for Near leg of swap,  2 for Far leg of swap';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.COMPOSITE IS 'C - Hexadecimal (0-F) 0-non-composite, 1 - basket trade with synthetic instrument, 2-F: non-synthetic components of a composite trade';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.TICKET_TYPE IS 'INTER_DEALER  ticket between market counterparties.  PB_SYNTHETIC  PB ticket with PC. PC_SYNTHETIC   PC ticket with PB Parent.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.TXN_TIME IS 'Timestamp of the trade on the execution platform. For EBSD trades - the timestamp provided by the LP.
07:38:31   2  This is not sending time, this is actual execution time';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.EXEC_ID2 IS 'LP assigned Trade Identifier. Unique per LP. Conditionally required if MarketSegment=EBSD, EBSD_FA, or EBS_RFQ.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.INSTR_SEC_ID IS 'Execution system instrument id, unique in scope of execution system (marketSegment)';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.INSTR_SYMBOL IS 'Standard representation of currency pair, .e.g EUR/USD. Does not include tenor or security type.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.INSTR_PRODUCT_TYPE IS 'SPT, FWD, FXS, NDF, NDS';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.MARKET_SEGMENT IS 'Market Segment of instrument:
07:38:31   2   EBSM - EBS Market [1]
07:38:31   3   EBSD - EBS  Direct [2]
07:38:31   4   EBSD_FA  EBS Direct Full Amount [3]
07:38:31   5   EBSD_RFQ[4]
07:38:31   6   EBSM_HEDGE[5]';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.ECN IS '20 - EBSM, 21 - EBSD, 22 - EBSD_HEDGE, 23 - xxxx, 24 - xxxx';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.ALGO_TYPE IS '20 - SWEEP, 21 - FULL 22 - RFQ,';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.TENOR_TYPE IS 'Tenor type of this leg:
07:38:31   2  [12] Spot Spot date
07:38:31   3  [1] T Days after trade date.
07:38:31   4  [2] D Days after spot value date
07:38:31   5  [3] Wk Week after spot date
07:38:31   6  [4] Mth Month after spot date
07:38:31   7  [5] Yr Years
07:38:31   8  [7] IMM_Q Quarterly IMM. Next nth IMM after Spot date.
07:38:31   9  [20] Broken Broken dates';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.TENOR_VALUE IS 'Relevant only for NDF, NDF Swap, or FX Swap:
07:38:31   2  Value of tenorType (#  of days, weeks, years, IMMs)
07:38:31   3  Required for tenorTypes:	DAYS , WEEKS, MONTHS, YEARS , ROLLING _IMM , & FIXED _IMM.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.SPOT_SETTL_DATE IS 'Relevant for NDF, FWD, NDF SWAP, & FX SWAP legs only. The settlement date of the associated SPOT pair.
07:38:31   2  Spot settlement date will be the same for all legs (since doesnt consider tenor.)';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.IS_TERM_CCY IS 'Indicates whether the Dealt Currency of the trade is the Term Currency (CCY2).
07:38:31   2  All quantities and sides specified in the TCR are expressed in terms of the Dealt Currency.
07:38:31   3  Default=False (Dealt Currency is Base Currency, CCY1.)';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.CCY_DEALT IS 'Three character ISO code of the base currency of this leg.';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.CCY_CONTRA IS 'Three character ISO code of the base currency of this leg.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.QTY_DEALT IS 'The trade size of this leg, in units of baseAsset. Units of the BaseAsset of this leg being bought or sold.';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.QTY_CNTR IS 'Contra-size of this leg, in units of the contra Asset.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_SWAP_POINTS IS 'Relevant for Swap trades only. Difference between the all-in rate of the far leg and the near leg.
07:38:31   2  May be a positive, negative, or zero.';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_ALLIN IS 'The price of this leg. May be positive, negative, or zero. Not provided for trades which have not yet been fixed.
07:38:31   2  The all-in price of this leg of the trade. Includes any relevant white label markups for this leg.
07:38:31   3  Does not include prime spread.';

Comment created.

Elapsed: 00:00:00.05
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_BD_BASE IS 'Raw market rate to which all the markup rates are applied.  Rate without markup.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_BD_TRADER IS 'Trader markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_BD_SALESM IS 'Sales markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_BD_ECOM IS 'eCom markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_BD_VENUE IS 'Venue markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_SPOT_BD_BASE IS 'Raw market rate to which all the markup rates are applied.	Rate without markup.';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_SPOT_BD_TRADER IS 'Trader markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_SPOT_BD_SALESM IS 'Sales markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_SPOT_BD_ECOM IS 'eCom markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_SPOT_BD_VENUE IS 'Venue markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_FWDP_BD_BASE IS 'Raw market rate to which all the markup rates are applied.	Rate without markup.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_FWDP_BD_TRADER IS 'Trader markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_FWDP_BD_SALESM IS 'Sales markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_FWDP_BD_ECOM IS 'eCom markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_FWDP_BD_VENUE IS 'Venue markup to be applied to the base rate. Default =0';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_PRIME_SPREAD IS 'For trades executed through a PB, represents the prime spread (markup) to be added to the all-in-price of the leg.
07:38:31   2  Equals zero, if not a prime trade. (Default) Note: Prime Spread has additional price precision.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.PX_EFFECTIVE IS 'For trades executed through a PB, represents the all-in trade price to the PC, including the prime spread.
07:38:31   2  Not present, if not a prime trade. Decimal precision adjusted for prime spread';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.FP_EXEC_SIDE IS 'S - side 1- Taker/LC,	2-Maker/LP';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.FP_SIDE IS 'Side of this trade leg from first party perspective, in terms of the trades Dealt Currency.	BUY[0]	SELL[1]';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.FP_ROLE IS 'O - Origin';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.FP_ACCOUNT IS 'Account of FP_FLOOR as it was defiend at the moment of Ticket Creation, unless it was specified on the deal';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.CP_ROLE IS 'D - Destination';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.CP_ACCOUNT IS 'Account of CP_FLOOR as it was defiend at the moment of Ticket Creation, unless it was specified on the deal';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.EFP_EBS_ORDER_ID IS 'OrderId assigned by EBS to partys order. EBS orderId is always 14 ascii characters	xxxx-xxxx-xxxx, including hyphens.';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.EFP_ORDER_ID IS 'Identifier of the order, as assigned by the client in NOS.';

Comment created.

Elapsed: 00:00:00.01
07:38:31 SQL> COMMENT ON COLUMN FX_TICKET_LEG.END_DATE IS 'The date after which the record can be archived (subj. to the retention policy)';

Comment created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/SCHEMA_VERSION.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/SCHEMA_VERSION.table  ****/
07:38:31 SQL> CREATE TABLE SCHEMA_VERSION (
07:38:31   2  	      APP_NAME	      VARCHAR2(64 BYTE)       NOT NULL ,
07:38:31   3  	      VERSION_ID      NUMBER(10,0)	      NOT NULL ,
07:38:31   4  	      VERSION_NAME    VARCHAR2(64 BYTE)       NOT NULL ,
07:38:31   5  	      CREATION_TIME   DATE DEFAULT sysdate    NOT NULL
07:38:31   6  )
07:38:31   7  TABLESPACE ^TBL_TBS;
old   7: TABLESPACE ^TBL_TBS
new   7: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.02
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/SD_SOURCE.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/SD_SOURCE.table	****/
07:38:31 SQL> CREATE TABLE SD_SOURCE (
07:38:31   2  	  ID				 NUMBER(10)	      NOT NULL,
07:38:31   3  	  SOURCE_TYPE			 NUMBER(10)	      NOT NULL, -- enum: MSL =1
07:38:31   4  	  DESCRIPTION			 VARCHAR2(64)	      NOT NULL,
07:38:31   5  	  REGION			 VARCHAR2(2)	      NOT NULL, -- LN, NY TY
07:38:31   6  	      DOMAIN_ID 					 NUMBER(10)		      NOT NULL,
07:38:31   7  	  CONNECT_DATA_A		 VARCHAR2(2048)       NOT NULL,
07:38:31   8  	  CONNECT_DATA_B		 VARCHAR2(2048)
07:38:31   9  )
07:38:31  10  TABLESPACE ^TBL_TBS;
old  10: TABLESPACE ^TBL_TBS
new  10: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.05
07:38:31 SQL> 
07:38:31 SQL> CREATE UNIQUE INDEX PK_SD_SOURCE ON SD_SOURCE(ID) TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_SD_SOURCE ON SD_SOURCE(ID) TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_SD_SOURCE ON SD_SOURCE(ID) TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.01
07:38:31 SQL> ALTER TABLE SD_SOURCE ADD CONSTRAINT PK_SD_SOURCE PRIMARY KEY (ID) USING INDEX;

Table altered.

Elapsed: 00:00:00.01
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/SD_TARGET.table  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/tables/SD_TARGET.table	****/
07:38:31 SQL> CREATE TABLE SD_TARGET (
07:38:31   2  	  ID				 NUMBER(10)	      NOT NULL,
07:38:31   3  	  TARGET_TYPE			 NUMBER(10)	      NOT NULL, -- enum: MSL =1
07:38:31   4  	  DESCRIPTION			 VARCHAR2(64)	      NOT NULL,
07:38:31   5  	  REGION			 VARCHAR2(2)	      NOT NULL, -- LN, NY TY
07:38:31   6  	      DOMAIN_ID 					 NUMBER(10)		      NOT NULL,
07:38:31   7  	  CONNECT_DATA_A		 VARCHAR2(2048)       NOT NULL,
07:38:31   8  	  CONNECT_DATA_B		 VARCHAR2(2048),
07:38:31   9  	  LAST_SESSION					 NUMBER(30), -- 'Value of MSL session id of last processed message'
07:38:31  10  	  LAST_ID						 NUMBER(30), -- 'Value of MSL sequence id of last processed message'
07:38:31  11  	  LAST_SRC_SESSION			 NUMBER(30), -- 'Value of MSL session id of last message as it was received by core'
07:38:31  12  	  LAST_SRC_ID					 NUMBER(30)  -- 'Value of MSL sequence id of last message as it was received by core'
07:38:31  13  )
07:38:31  14  TABLESPACE ^TBL_TBS;
old  14: TABLESPACE ^TBL_TBS
new  14: TABLESPACE PTRADEDATA

Table created.

Elapsed: 00:00:00.02
07:38:31 SQL> 
07:38:31 SQL> CREATE UNIQUE INDEX PK_SD_TARGET ON SD_TARGET(ID) TABLESPACE ^IDX_TBS;
old   1: CREATE UNIQUE INDEX PK_SD_TARGET ON SD_TARGET(ID) TABLESPACE ^IDX_TBS
new   1: CREATE UNIQUE INDEX PK_SD_TARGET ON SD_TARGET(ID) TABLESPACE PTRADEINDX

Index created.

Elapsed: 00:00:00.01
07:38:31 SQL> ALTER TABLE SD_TARGET ADD CONSTRAINT PK_SD_TARGET PRIMARY KEY (ID) USING INDEX;

Table altered.

Elapsed: 00:00:00.01
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/data/sd_target_data.sql	****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/data/sd_target_data.sql  ****/
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	       CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (100, 1,	       'MyT-FS-CSV',	'US',	1,	   'CONNECT_DATA_A-DUMMY',  NULL,	   NULL,	 NULL,	   NULL,	    NULL);

1 row created.

Elapsed: 00:00:00.21
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	       CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (101, 1,	       'Common-FS-CSV',    'US',   1,	      'CONNECT_DATA_A-DUMMY',  NULL,	      NULL,	    NULL,     NULL,	       NULL);

1 row created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	       CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (200, 2,	       'KAFKA7-TCR',	'US',	1,	   'CONNECT_DATA_A-DUMMY',   NULL,	    NULL,	  NULL,     NULL,	     NULL);

1 row created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	       CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (300, 3,	       'Sapphire-Redis-JSON',  'US',   1,	  'CONNECT_DATA_A-DUMMY',  NULL,	  NULL, 	NULL,	  NULL, 	   NULL);

1 row created.

Elapsed: 00:00:00.01
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	       CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (301, 3,	       'Sapphire-Redis-JSON',  'US',   1,	  'CONNECT_DATA_A-DUMMY',  NULL,	  NULL, 	NULL,	  NULL, 	   NULL);

1 row created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	      CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (400, 4,	       'Traiana-MQ-CSV',   'US',   1,	      'CONNECT_DATA_A-DUMMY',  NULL,	      NULL,	   NULL,     NULL,	      NULL);

1 row created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	      CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (500, 5,	       'TOF',	'US',	1,	   'CONNECT_DATA_A-DUMMY',  NULL,	   NULL,	NULL,	  NULL, 	   NULL);

1 row created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> insert into SD_TARGET (ID, TARGET_TYPE, DESCRIPTION, REGION, DOMAIN_ID, CONNECT_DATA_A,	      CONNECT_DATA_B, LAST_SESSION, LAST_ID, LAST_SRC_SESSION, LAST_SRC_ID)
07:38:31   2  		     values (600, 6,	       'RTNS-FIX',   'US',   1, 	'CONNECT_DATA_A-DUMMY',  NULL,		NULL,	     NULL,     NULL,		NULL);

1 row created.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> commit;

Commit complete.

Elapsed: 00:00:00.00
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/views/V_FX_TICKET_LEG.view  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/views/V_FX_TICKET_LEG.view  ****/
07:38:31 SQL> CREATE OR REPLACE FORCE VIEW V_FX_TICKET_LEG AS
07:38:31   2  SELECT
07:38:31   3  	TXN_TIME,
07:38:31   4  	INSTR_SYMBOL,
07:38:31   5  	INSTR_PRODUCT_TYPE,
07:38:31   6  	TENOR_TYPE,
07:38:31   7  	TENOR_VALUE,
07:38:31   8  	CASE
07:38:31   9  	  WHEN TENOR_TYPE=12 AND INSTR_PRODUCT_TYPE=0 THEN NULL
07:38:31  10  	  WHEN TENOR_TYPE=12 THEN 'SPOT'
07:38:31  11  	  WHEN TENOR_TYPE=20 THEN 'B'
07:38:31  12  	  WHEN TENOR_TYPE=1 AND TENOR_VALUE=0 then 'TOD'
07:38:31  13  	  WHEN TENOR_TYPE=1 AND TENOR_VALUE=1 then 'TOM'
07:38:31  14  	  WHEN TENOR_TYPE=1 AND TENOR_VALUE=2 then 'NEXT'
07:38:31  15  	  WHEN TENOR_TYPE=2 AND TENOR_VALUE=1 then 'NEXT'
07:38:31  16  	  WHEN TENOR_TYPE=3 THEN TENOR_VALUE||'Wk'
07:38:31  17  	  WHEN TENOR_TYPE=4 THEN TENOR_VALUE||'Mth'
07:38:31  18  	  WHEN TENOR_TYPE=7 THEN 'IMM1'
07:38:31  19  	  else NULL
07:38:31  20  	end VC_TENOR_TYPE,
07:38:31  21  	MARKET_SEGMENT,
07:38:31  22  	TRADE_DATE,
07:38:31  23  	DATE_SETTLEMENT,
07:38:31  24  	DATE_MATURITY,
07:38:31  25  	QTY_DEALT,
07:38:31  26  	QTY_DEALT_EXP,
07:38:31  27  	VC_QTY_DEALT,
07:38:31  28  	CCY_DEALT,
07:38:31  29  	QTY_CNTR,
07:38:31  30  	QTY_CNTR_EXP,
07:38:31  31  	VC_QTY_CNTR,
07:38:31  32  	CCY_CONTRA,
07:38:31  33  	PX_EFFECTIVE,
07:38:31  34  	PX_EFFECTIVE_EXP,
07:38:31  35  	VC_PX_EFFECTIVE,
07:38:31  36  	EXEC_ID,
07:38:31  37  	FP_EXEC_SIDE,
07:38:31  38  	FP_SIDE,
07:38:31  39  	FP_TRADER,
07:38:31  40  	ID  AS TICKET_ID,
07:38:31  41  	EFP_EBS_ORDER_ID,
07:38:31  42  	CP_ACCOUNT ,
07:38:31  43  	CP_TRADER,
07:38:31  44  	FP_INSTITUTION_KEY,
07:38:31  45  	DOMAIN_ID ,
07:38:31  46  	FP_FLOOR,
07:38:31  47  	ALGO_TYPE
07:38:31  48  FROM   FX_TICKET_LEG L;

View created.

Elapsed: 00:00:00.02
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/views/V_SD_FLOORS.view  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/../../src/main/db/views/V_SD_FLOORS.view	****/
07:38:31 SQL> CREATE OR REPLACE FORCE VIEW V_SD_FLOORS AS
07:38:31   2  SELECT
07:38:31   3  	N.FLOOR_KEY AS FLOOR_KEY,
07:38:31   4  	N.DEAL_CODE AS FLOOR_CODE,
07:38:31   5  	N.ACCOUNT_ID AS ACCOUNT_ID,
07:38:31   6  	N.INSTITUTION AS INST_CODE,
07:38:31   7  	I.INSTITUTION_KEY AS INST_KEY,
07:38:31   8  	I.INSTITUTION_NAME AS INST_NAME,
07:38:31   9  	--CASE WHEN N.PARENT_FLOOR_KEY=0 THEN NULL ELSE N.PARENT_FLOOR_KEY END AS PARENT_FLOOR_KEY,
07:38:31  10  	N.PARENT_FLOOR_KEY,
07:38:31  11  	CASE
07:38:31  12  	   WHEN N.IS_PB=0 AND N.IS_PC=0 THEN 0 -- PP/SPOT  (1 -- PP, 4 - SPOT)
07:38:31  13  	   WHEN N.IS_PB=1 AND N.IS_PC=0 THEN 2 -- PB
07:38:31  14  	   WHEN N.IS_PB=0 AND N.IS_PC=1 THEN 3 -- PC
07:38:31  15  	   ELSE 0
07:38:31  16  	END AS FLOOR_TYPE,
07:38:31  17  	N.NODE_NAME,
07:38:31  18  	N.LOCATION_NAME,
07:38:31  19  	N.COUNTRY_CODE,
07:38:31  20  	N.TIMEZONE_NAME,
07:38:31  21  	N.SWIFT_CODE,
07:38:31  22  	L.REGULATORY_ID AS LEI,
07:38:31  23  	N.PROD_ENABLED,
07:38:31  24  	N.PROD_LIFE,
07:38:31  25  	N.COMPATIBLE,
07:38:31  26  	N.MKR_TKR_FLAG,
07:38:31  27  	N.VIRTUAL_FLOOR_ID,
07:38:31  28  	N.PARENT_BITS,
07:38:31  29  	N.CREATION_TIME,
07:38:31  30  	N.IS_LC,
07:38:31  31  	N.IS_LP,
07:38:31  32  	N.IS_DISCLOSED,
07:38:31  33  	N.IS_NEW_POST_TRADE
07:38:31  34  	-- N.SMALL_AMT_MATCHING_ENABLED,
07:38:31  35  	-- N.IS_PROD_ENABLED_OUTRIGHT,
07:38:31  36  	-- N.IS_RFQ_LP_FLOOR,
07:38:31  37  	-- N.IS_ESP_LP_FLOOR,
07:38:31  38  	-- N.IS_LP_BOOK_TYPE_SWEEPABLE,
07:38:31  39  	-- N.IS_LP_BOOK_TYPE_FULL_AMOUNT,
07:38:31  40  	-- N.IS_RFQ_CREDIT_CHECK_REQUIRED,
07:38:31  41  	-- N.IS_ESP_PRE_TRD_CRD_CHK_REQ
07:38:31  42  	-- N.COMPONENT_NUM,
07:38:31  43  	-- N.NETL_DORMANT_A,
07:38:31  44  	-- N.NETL_DORMANT_B,
07:38:31  45  	-- N.NETL_ARB_NODE,
07:38:31  46  	-- N.NETL_DISTR_NODE,
07:38:31  47  	-- N.LEGACY_MODE_IND,
07:38:31  48  	-- N.PUBLISHED_ADDRESS,
07:38:31  49  	-- N.MSG_VERSION,
07:38:31  50  	-- N.ARB_GROUP_ID,
07:38:31  51  	-- N.IS_PROD_ENABLED_SPOT,
07:38:31  52  	-- N.IS_PROD_ENABLED_NDF,
07:38:31  53  	-- N.IS_PROD_ENABLED_SWAP,
07:38:31  54  	-- N.NETL_NETW_CTRL_NODE,
07:38:31  55  FROM SDATA.NODES_BIN N,
07:38:31  56  	   SDATA.INSTITUTION_BIN I,
07:38:31  57  	   (SELECT DISTINCT EBS_DEAL_CODE, REGULATORY_ID FROM SDATA.GCD_TRADER_INFO) L
07:38:31  58  WHERE N.NODE_TYPE = 1
07:38:31  59  	    AND N.DELETED = 0
07:38:31  60  	    AND N.INSTITUTION = I.INSTITUTION_CODE
07:38:31  61  	    AND I.IS_ACTIVE = 1
07:38:31  62  	    AND N.DEAL_CODE = L.EBS_DEAL_CODE(+)
07:38:31  63  ;

View created.

Elapsed: 00:00:00.02
07:38:31 SQL> 
07:38:31 SQL> 
07:38:31 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/validations.sql	****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/validations.sql  ****/
07:38:31 SQL> 
07:38:31 SQL> exec EBS_SCHEMA_UTIL.check_Objects_naming;

PL/SQL procedure successfully completed.

Elapsed: 00:00:04.40
07:38:36 SQL> 
07:38:36 SQL> --health check
07:38:36 SQL> 
07:38:36 SQL> begin
07:38:36   2  	       DBMS_UTILITY.COMPILE_SCHEMA (USER,false);
07:38:36   3  	       for i in 1..3 loop
07:38:36   4  		   for j in (select object_name from user_objects where status<>'VALID' and object_type='VIEW') loop
07:38:36   5  		       begin
07:38:36   6  			 execute immediate 'alter view '||j.object_name||' compile';
07:38:36   7  		       exception
07:38:36   8  			 when others then null;
07:38:36   9  		       end;
07:38:36  10  		   end loop;
07:38:36  11  	       end loop;
07:38:36  12  end;
07:38:36  13  /

PL/SQL procedure successfully completed.

Elapsed: 00:00:05.47
07:38:41 SQL> 
07:38:41 SQL> select OBJECT_TYPE, OBJECT_NAME, STATUS  from user_objects where status<>'VALID' ORDER BY 1,2;

no rows selected

Elapsed: 00:00:00.07
07:38:41 SQL> 
07:38:41 SQL> begin
07:38:41   2  	  DBMS_STATS.gather_schema_stats(user);
07:38:41   3  end;
07:38:41   4  /

PL/SQL procedure successfully completed.

Elapsed: 00:00:21.19
07:39:03 SQL> 
07:39:03 SQL> 
07:39:03 SQL> 
07:39:03 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/go_public.sql  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/go_public.sql  ****/
07:39:03 SQL> create or replace procedure go_public (obj_type in varchar2 default '%', obj_name in varchar2 default '%', grantee_name in varchar2 default 'PUBLIC' ) is
07:39:03   2  	  lpublicSQL varchar2(4000);
07:39:03   3  	  lGrantType varchar2(20);
07:39:03   4  begin
07:39:03   5  	  for i in (select OBJECT_NAME, OBJECT_TYPE
07:39:03   6  		    from user_objects
07:39:03   7  		    where object_name like obj_name
07:39:03   8  		      and object_type like obj_type
07:39:03   9  		      and object_type in ('TABLE','VIEW','PROCEDURE','FUNCTION','PACKAGE')
07:39:03  10  		    order by OBJECT_TYPE, OBJECT_NAME)
07:39:03  11  	  loop
07:39:03  12  	      begin
07:39:03  13  		  case
07:39:03  14  		      when i.object_type in ('TABLE','VIEW') then lGrantType := 'SELECT';
07:39:03  15  		      when i.object_type in ('PROCEDURE','FUNCTION','PACKAGE') then lGrantType := 'EXECUTE';
07:39:03  16  		      else lGrantType := 'ERROR';
07:39:03  17  		  end case;
07:39:03  18  		  lpublicSQL := 'GRANT '|| lGrantType ||' on '||i.object_name||' to '||grantee_name;
07:39:03  19  		  dbms_output.put_line(lpublicSQL);
07:39:03  20  		  execute immediate lpublicSQL;
07:39:03  21  	      exception
07:39:03  22  		  when others then null;
07:39:03  23  	      end;
07:39:03  24  	  end loop;
07:39:03  25  end;
07:39:03  26  /

Procedure created.

Elapsed: 00:00:00.12
07:39:03 SQL> 
07:39:03 SQL> begin
07:39:03   2  	  go_public;
07:39:03   3  end;
07:39:03   4  /

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.84
07:39:04 SQL> 
07:39:04 SQL> 
07:39:04 SQL> 
07:39:04 SQL> 
07:39:04 SQL> 
07:39:04 SQL> prompt /**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/footer.sql  ****/
/**** File: /export/home/staff/perforce_workspace/pts/MAIN/Packaging/database/templates/footer.sql  ****/
07:39:04 SQL> 
07:39:04 SQL> begin
07:39:04   2  	  EBS_SCHEMA_UTIL.log_uplaod('Post Trade', ^MAJOR, ^MINOR, to_number(substr('^PATCH',3)), ^EBS, EBS_UPLOAD_UTILS.C_VERSION_END_OK, 'Fresh instalation');
07:39:04   3  	  go_public;
07:39:04   4  end;
07:39:04   5  /
old   2:     EBS_SCHEMA_UTIL.log_uplaod('Post Trade', ^MAJOR, ^MINOR, to_number(substr('^PATCH',3)), ^EBS, EBS_UPLOAD_UTILS.C_VERSION_END_OK, 'Fresh instalation');
new   2:     EBS_SCHEMA_UTIL.log_uplaod('Post Trade', 1, 3, to_number(substr('-p0',3)), 13, EBS_UPLOAD_UTILS.C_VERSION_END_OK, 'Fresh instalation');

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.09
07:39:04 SQL> 
07:39:04 SQL> -- TODO!!! replace the hardcoded version with the one taken from the env
07:39:04 SQL> insert into SCHEMA_VERSION (APP_NAME, VERSION_ID, VERSION_NAME) values ('PostTrade', 1, '1.3.13.0');

1 row created.

Elapsed: 00:00:00.05
07:39:04 SQL> 
07:39:04 SQL> spool off
07:39:04 SQL> exit 0
Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning and Automatic Storage Management options
[33mCreating link PT_DB...[0m
`/export/home/oracle/Automation/PT_DB' -> `/export/home/oracle/Automation/packages/PT_DB_1.3.13.0_ptrade'
[32m
2016-01-04_07:39:04,301 -- Installation finished[0m
